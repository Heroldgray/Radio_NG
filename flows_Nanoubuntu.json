[{"id":"c43f5f8e.e4ee6","type":"tab","label":"France Musique NG","disabled":false,"info":""},{"id":"2bb9e260.b0adde","type":"tab","label":"Mouv NG","disabled":false,"info":""},{"id":"40eacea7.33a8e8","type":"tab","label":"Metadata Processing","disabled":true,"info":""},{"id":"8c03cacb.961ff8","type":"subflow","name":"RF Song","info":"Subflow pour traitement des données en mode \"song\"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"db12b58.afe0c48"}]}],"out":[{"x":420,"y":80,"wires":[{"id":"db12b58.afe0c48","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"56eea0e0.0ebaa","type":"subflow","name":"Roon/Liked","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"58eda792.abe8c8"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"b572a7ac.5cbd38","type":"ui_group","name":"Now","tab":"cebaaf18.c1734","order":1,"disp":false,"width":"6","collapse":false},{"id":"f7803f0d.a47f","type":"mqtt-broker","name":"Mosquitto RPI3","broker":"192.168.0.176","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"cebaaf18.c1734","type":"ui_tab","name":"France Musique","icon":"fa-music","order":2,"disabled":false,"hidden":false},{"id":"1c27239e.6f8fec","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"Arial,Arial,Helvetica,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"Arial,Arial,Helvetica,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"Arial,Arial,Helvetica,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":0,"gy":0,"cx":10,"cy":6,"px":7,"py":0}}},{"id":"de800846.fe2ce8","type":"ui_group","name":"hidden_group","tab":"389079d6.e2f896","order":1,"disp":false,"width":"6","collapse":false},{"id":"389079d6.e2f896","type":"ui_tab","name":"Barre de navigation","icon":"home","order":1,"disabled":false,"hidden":false},{"id":"f63c93cf.832d6","type":"ui_group","name":"Now","tab":"3c8f621f.6f11de","order":1,"disp":false,"width":"6","collapse":false},{"id":"9d92f898.7e3358","type":"mqtt-broker","name":"Mosquitto Local","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"3c8f621f.6f11de","type":"ui_tab","name":"Mouv'","icon":"fa-music","order":3,"disabled":false,"hidden":false},{"id":"6aa20356.9b59bc","type":"ui_group","name":"chart","tab":"d5ad8b85.f5ba18","order":1,"disp":true,"width":"16","collapse":false},{"id":"d5ad8b85.f5ba18","type":"ui_tab","name":"Plotly","icon":"dashboard","disabled":false,"hidden":false},{"id":"db12b58.afe0c48","type":"function","z":"8c03cacb.961ff8","name":"Traitements mode song","func":"//////////////////////////////////////////////////////////\n// Fonction traitement des données générique RF MUSIQUE //\n//////////////////////////////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n//////////////////////////////////////////////////////////////////////\n// Affectation Début, Fin, Durée. Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n/////////////////////////////////////////////////////////////////\n// Lecture et traitement des Metadata\nvar playing_item = msg.payload.data.now.playing_item.song;\n// Debug console\nif (playing_item) {\n  msg.playing_item_null = \"OK\";\n} else {\n  msg.playing_item_null = \"Mode Program KO\";\n}\n\n/// Test sur Song, sauvegarde contextuelle des variabales pour éviter le Typeerror lors de la transition quand l'objet song est null. \n\nif (playing_item !== null) {\n\n  // Cover (test pour afficgage image locale si l'url de la pochette n'est pas livrée)\n  if (typeof playing_item.cover !== 'undefined' && playing_item.cover !== null) {\n    msg.erreur_cover = \"cover OK\";\n    var cover = playing_item.cover;\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  } else {\n    msg.erreur_cover = \"cover est Undefined ou Null: \" + cover;\n    var cover = \"/images/missing_\" + msg.chaine_short + \"_315.png\";\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  }\n\n  // Composer\n  if (typeof playing_item.compositors[0] !== 'undefined' && playing_item.compositors[0] !== null) {\n    msg.erreur_composer = \"composer OK\";\n    var composer = playing_item.compositors[0].capitalize();\n    context.set(\"composersave\", composer);\n    msg.composer = composer;\n  } else {\n    msg.erreur_composer = \"composer Undefined\";\n    var composer = \"\";\n    context.set(\"composersave\", composer);\n    msg.composer = composer;\n  }\n\n  // Artist\n  if (typeof playing_item.subtitle !== 'undefined' && playing_item.subtitle !== null) {\n    msg.erreur_artist = \"artist OK et non null\";\n    var artist = playing_item.subtitle.capitalize();\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  } else {\n    msg.erreur_artist = \"artist Undefined ou null\";\n    var artist = \"\";\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  }\n\n  // Title\n  if (typeof playing_item.title !== 'undefined' && playing_item.title !== null) {\n    msg.erreur_title = \"title OK\";\n    var title = playing_item.title.capitalizeinitial();\n    context.set(\"titlesave\", title);\n    msg.title = title;\n  } else {\n    msg.erreur_title = \"title est Undefined ou Null\";\n    var title = \"\";\n    context.set(\"titlesave\", title);\n    msg.title = title;\n  }\n\n  // Album\n  if (typeof playing_item.album !== 'undefined' && playing_item.album !== null) {\n    msg.erreur_album = \"album OK\";\n    var album = playing_item.album.capitalizeinitial();\n    // on affecte l'album si il est différent du titre sinon on l'oublie\n    if (title.toUpperCase() == album.toUpperCase()) {\n      msg.album_title = \"titre et album sont identiques\";\n      album = \"\";\n      msg.album = album;\n    }\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  } else {\n    msg.erreur_album = \"album est Undefined\";\n    var album = \"\";\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  }\n\n  // Label\n  if (typeof playing_item.label !== 'undefined' && playing_item.label !== null) {\n    msg.erreur_label = \"label OK\";\n    var label = playing_item.label.toUpperCase();\n    context.set(\"labelsave\", label);\n    msg.label = label;\n\n  } else {\n    msg.erreur_label = \"label est Undefined\";\n    var label = \"\";\n    context.set(\"labelsave\", label);\n    msg.label = label;\n  }\n\n  // Orchestre\n  if (typeof playing_item.orchestras[0] !== 'undefined' && playing_item.orchestras[0] !== null) {\n    msg.erreur_orchestre = \"Orchestre OK\";\n    var orchestre = playing_item.orchestras[0];\n    context.set(\"orchestresave\", orchestre);\n    msg.orchestre = orchestre;\n\n  } else {\n    msg.erreur_orchestre = \"orchestre est Undefined\";\n    var orchestre = \"\";\n    context.set(\"orchestresave\", orchestre);\n    msg.orchestre = orchestre;\n  }\n\n  // Chef\n  if (typeof playing_item.orchestra_leaders[0] !== 'undefined' && playing_item.orchestra_leaders[0] !== null) {\n    msg.erreur_chef = \"Chef OK\";\n    var chef = playing_item.orchestra_leaders[0];\n    context.set(\"chefsave\", chef);\n    msg.chef = chef;\n\n  } else {\n    msg.erreur_chef = \"Chef est Undefined\";\n    var chef = \"\";\n    context.set(\"chefsave\", chef);\n    msg.chef = chef;\n  }\n\n  // Year\n  if (typeof playing_item.year !== 'undefined' && playing_item.year !== null) {\n    msg.erreur_year = \"Year OK\";\n    var year = playing_item.year;\n    context.set(\"yearsave\", year);\n    msg.year = year;\n\n  } else {\n    msg.erreur_year = \"Year est Undefined\";\n    var year = \"\";\n    context.set(\"yearsave\", year);\n    msg.year = year;\n  }\n\n  // Concaténation Orchestre + Chef avec séparateur, n'est utilisé que pour l'UI Web / \n  if ((orchestre !== \"\") && (chef !== \"\")) {\n    var orchestrechef = orchestre + \" / \" + chef\n  } else {\n    var orchestrechef = orchestre + chef\n  }\n\n} else {\n  msg.cover = context.get(\"coversave\");\n  msg.composer = context.get(\"composersave\");\n  msg.chef = context.get(\"chefsave\");\n  msg.year = context.get(\"yearsave\");\n  msg.orchestre = context.get(\"orchestresave\");\n  msg.artist = context.get(\"artistsave\");\n  msg.title = context.get(\"titlesave\");\n  msg.album = context.get(\"albumsave\");\n  msg.label = context.get(\"labelsave\");\n\n  // Concaténation Orchestre + Chef avec séparateur / \n  if ((msg.orchestre !== \"\") && (msg.chef !== \"\")) {\n    var orchestrechef = msg.orchestre + \" / \" + msg.chef\n  } else {\n    var orchestrechef = msg.orchestre + msg.chef\n  }\n}\n\nmsg.orchestrechef = orchestrechef.capitalize();\n\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(3) + Chaine(4) + Radio(5) + Artist(6) + Titre(7) + Album(8) + Label(9) + Cover(10) + Composer (11) + Ochestre (12) + Chef (13) + Year (14)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion = moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion = moment(start).format('HH[h]mm');\nvar now_playing = msg.duree + \"|\" + msg.chaine + \"|\" + msg.radio + \"|\" + msg.artist + \"|\" + msg.title + \"|\" + msg.album + \"|\" + msg.label + \"|\" + msg.cover + \"|\" + msg.composer + \"|\" + msg.orchestre + \"|\" + msg.chef + \"|\" + msg.year;\nmsg.now_playing_liked = timestamp + \"|\" + date_diffusion + \"|\" + heure_diffusion + \"|\" + now_playing;\n\n///////////////////////////////////////////////////////////////////\n// Formatage des Meta pour IceCast: (Composer) / Artiste - Titre //\n///////////////////////////////////////////////////////////////////\n//msg.title_ice = msg.title;\n//msg.composer_ice = msg.composer;\n//console.log (msg.radio);\n//console.log (typeof msg.title + \": \" + msg.title);\n//console.log (typeof msg.composer + \": \" + msg.composer);\n//console.log (typeof msg.artist + \": \" + msg.artist);\n\nlet parseText = function (text, limit) {\n  if (text.length > limit) {\n    for (let i = limit; i > 0; i--) {\n      if (\n        text.charAt(i) === \" \" &&\n        (text.charAt(i - 1) != \",\" ||\n          text.charAt(i - 1) != \".\" ||\n          text.charAt(i - 1) != \";\")\n      ) {\n        return text.substring(0, i) + \"...\";\n      }\n    }\n    return text.substring(0, limit) + \"...\";\n  } else return text;\n};\n\nmsg.composer_ice = msg.composer;\nmsg.artist_ice = parseText (msg.artist, 45);\nmsg.title_ice =  parseText (msg.title, 60);\n\n//Si composer ET artiste ne sont pas vides on ajoute le separateur / pour delimiter composer et artiste \nif ((msg.composer_ice !== \"\") && (msg.artist_ice !== \"\")) {\n  msg.composer_ice = msg.composer_ice + \" / \"\n}\n//Si composer OU artiste ne sont pas vides on ajoute le separateur - pour delimiter (composer / artiste) et titre\nif ((msg.composer_ice !== \"\") || (msg.artist_ice !== \"\")) {\nmsg.title_ice = \" - \" + msg.title_ice\n}\n// Concatenation de l'URL ICE pour mise à jour des Meta (Composer) / Artiste - Titre\nmsg.url = global.get('url_icecast') + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent(msg.composer_ice) + encodeURIComponent(msg.artist_ice) + encodeURIComponent(msg.title_ice) //+ encodeURIComponent (msg.album);\n\n///////////////////////////////////////////////////////////////////\n// Formatage des Meta pour logs                                  //\n///////////////////////////////////////////////////////////////////\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover + Orchestre + Chef + Year  (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing = now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":249,"y":80,"wires":[[]]},{"id":"45ba1ef9.bb6a6","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique La Baroque","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A408%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.98","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":180,"y":260,"wires":[["13c76f32.7b6f11"]]},{"id":"13c76f32.7b6f11","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":488,"y":259,"wires":[["7ae82a4.a0021d4"]]},{"id":"7ae82a4.a0021d4","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":260,"wires":[["ef01a2d0.63d47"]]},{"id":"83ea9d2f.830a7","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"La Baroque","order":1,"width":6,"height":"12","format":"<!--\n================================\nBaroque\n================================\n\nAudio HTML5 Control\n-->\n<div>\n<audio preload=\"none\" id=\"audio_Baroque\"></audio>\n    <!--<audio preload=\"none\" id={{msg.id_audio}}></audio>-->\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n  <button id=\"pButton_Baroque\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playBaroque()\"></button>\n    <!--<button id=\"pButton_Baroque\" class=\"fas fa-headphones-alt fa-2x\" onclick={{msg.my_onclickfunction}}></button>-->\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n          <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n  <h3 class=\"artiste\">{{msg.artist}}</h3>\n  <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1170,"y":260,"wires":[["e6655f69.a8158"]]},{"id":"338b8f70.6c1a3","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique Classique Easy","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A401%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.97","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":200,"y":299,"wires":[["f83d1bcb.499028"]]},{"id":"d7c80ccf.7ac55","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique Classique Plus","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A402%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.96","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":190,"y":339,"wires":[["c9fb7443.f5f258"]]},{"id":"4318494f.7459a8","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique Concerts Radio France","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A403%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.95","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":220,"y":379,"wires":[["5852b896.cf8fd8"]]},{"id":"fcd546d0.0dbd08","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique La Jazz","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A405%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"5.45","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":170,"y":419,"wires":[["14bcfc7d.dd3854"]]},{"id":"fce09886.5eb0e8","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique La Contemporaine","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A406%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.93","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":210,"y":459,"wires":[["878afd84.5dab2"]]},{"id":"357a106b.6a222","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique Ocora","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A404%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.92","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":170,"y":499,"wires":[["e50f427.18cdfc"]]},{"id":"28e7e3c3.d137ec","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique la BO","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A407%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.91","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":170,"y":539,"wires":[["ef340030.9a7ee"]]},{"id":"f83d1bcb.499028","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":488,"y":299,"wires":[["ba7d0cd5.94bc"]]},{"id":"ba7d0cd5.94bc","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":300,"wires":[["f488d40.786c13"]]},{"id":"822e2981.5a10f8","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"Classique Easy","order":3,"width":6,"height":"12","format":"            \n<!--\n================================\nEasy\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Easy\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Easy\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playEasy()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n    <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n  <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1180,"y":300,"wires":[["e6655f69.a8158"]]},{"id":"116a2853.60b7e8","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":340,"wires":[["facacb07.1a3bc8"]]},{"id":"f94eded4.1bde6","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"Classique Plus","order":2,"width":6,"height":"12","format":"<!--\n================================\nPlus\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Plus\"></audio>\n</div>\n\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Plus\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playPlus()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1180,"y":340,"wires":[["e6655f69.a8158"]]},{"id":"c9fb7443.f5f258","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":488,"y":339,"wires":[["116a2853.60b7e8"]]},{"id":"ce2343fd.5fbec","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":379,"wires":[["4d0c8d71.d056d4"]]},{"id":"dd6203b5.970da","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"Classique Concerts","order":6,"width":6,"height":"12","format":"<!--\n================================\nConcerts\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Concerts\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Concerts\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playConcerts()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n ","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1190,"y":379,"wires":[["e6655f69.a8158"]]},{"id":"5852b896.cf8fd8","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":379,"wires":[["ce2343fd.5fbec"]]},{"id":"334a836d.c1aafc","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":419,"wires":[["1626df44.ab5ea1"]]},{"id":"7532cc8a.dccb54","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"Classique Jazz","order":8,"width":6,"height":"12","format":"<!--\n================================\nJazz\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Jazz\"></audio>\n</div>\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Jazz\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playJazz()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1180,"y":419,"wires":[["e6655f69.a8158"]]},{"id":"14bcfc7d.dd3854","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":419,"wires":[["334a836d.c1aafc"]]},{"id":"f01d5723.3690c8","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":459,"wires":[["8aa0bfa3.8adf4"]]},{"id":"b66512a5.d3321","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"Contemporaine","order":5,"width":6,"height":"12","format":"<!--\n================================\nContemporaine\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Contemporaine\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Contemporaine\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playContemporaine()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1180,"y":459,"wires":[["e6655f69.a8158"]]},{"id":"878afd84.5dab2","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":459,"wires":[["f01d5723.3690c8"]]},{"id":"5e7d04df.c7694c","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":499,"wires":[["69121beb.bf58b4"]]},{"id":"433e7136.508a9","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"Ocora","order":7,"width":6,"height":"12","format":"            \n<!--\n================================\nOcora\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Ocora\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Ocora\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playOcora()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n     <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1150,"y":499,"wires":[["e6655f69.a8158"]]},{"id":"e50f427.18cdfc","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":499,"wires":[["5e7d04df.c7694c"]]},{"id":"cee1bf07.4f578","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":539,"wires":[["4f62815a.51472"]]},{"id":"39911df3.06dc52","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"La BO","order":9,"width":6,"height":"12","format":"            \n<!--\n================================\nLa B.O.\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Labo\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Labo\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playLabo()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1150,"y":539,"wires":[["e6655f69.a8158"]]},{"id":"ef340030.9a7ee","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":539,"wires":[["cee1bf07.4f578"]]},{"id":"1246b38a.b5438c","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A4%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.99","crontab":"","once":true,"onceDelay":0.1,"topic":"","payloadType":"str","x":150,"y":160,"wires":[["b8e4ecdb.212e3"]]},{"id":"f843460a.6ad2c8","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"France Musique","order":10,"width":6,"height":"12","format":"\n<!-- ================================\nFrance Musique (chaine principale)\n================================\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Musique\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Musique\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playMusique()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n          <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1180,"y":160,"wires":[["e6655f69.a8158"]]},{"id":"2dcac990.70c796","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":510,"y":160,"wires":[["4d97ed9f.d442d4"]]},{"id":"b8e4ecdb.212e3","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":350,"y":160,"wires":[["2dcac990.70c796"]]},{"id":"77c9c9c6.578288","type":"inject","z":"c43f5f8e.e4ee6","name":"France Musique Opera","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A409%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.91","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":170,"y":580,"wires":[["19cbfa47.0073e6"]]},{"id":"4d0f3104.f7d7f","type":"json","z":"c43f5f8e.e4ee6","name":"","property":"payload","action":"","pretty":false,"x":650,"y":580,"wires":[["18d1e50.f9a281b"]]},{"id":"19cbfa47.0073e6","type":"http request","z":"c43f5f8e.e4ee6","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":580,"wires":[["4d0f3104.f7d7f"]]},{"id":"9bccbb9e.74e8b8","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"Opéra","order":4,"width":6,"height":"12","format":"            \n<!--\n================================\nOpera\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_Opera\"></audio>\n</div>\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_Opera\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playOpera()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n<!-- Metadata -->\n <h2 class=\"composer\">{{msg.composer}}</h2>\n <h3 class=\"artiste\">{{msg.artist}}</h3>\n <h3 class=\"orchestrechef\">{{msg.orchestrechef}}</h3>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}} {{msg.year}}</h3>\n\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1150,"y":580,"wires":[["e6655f69.a8158"]]},{"id":"4d97ed9f.d442d4","type":"switch","z":"c43f5f8e.e4ee6","name":"","property":"payload.data.now.mode","propertyType":"msg","rules":[{"t":"eq","v":"song","vt":"str"},{"t":"eq","v":"program","vt":"str"}],"checkall":"false","repair":true,"outputs":2,"x":650,"y":160,"wires":[["4ac23bc8.6b3c04"],["c90fa730.e3f7c8"]]},{"id":"840778a5.3483b8","type":"function","z":"c43f5f8e.e4ee6","name":"RF Program","func":"/////////////////////////////////\n// Fonctions générique MUSIQUE //\n/////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n//////////////////////////////////////////////////////////////////////\n// Affectation Début, Fin, Durée, Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n////////////////////////////////////////////////////////////\n// SPECIFIQUE PROGRAM //////////////////////////////////////\nvar emission = msg.payload.data.now;\nif(typeof emission.program !== 'undefined' && emission.program !== null) \n{\n    msg.erreur_program = \"Program OK\";\n    var title  = emission.program.name;\n    msg.title = title;\n} else {\n    msg.erreur_program = \"Program Undefined\";\n    msg.title = \"Direct\";\n}\n// Cover, on force le logo statique car on est en mode \"program\" et non \"song\"\nvar cover = \"/images/France_Musique_logo_315_bordure.png\";\nmsg.cover = cover;\nmsg.composer = \"\";\nmsg.album = \"\";\nmsg.label = \"\";\nmsg.year = \"\";\nmsg.artist = \"\";\nmsg.orchestre = \"\";\nmsg.chef = \"\";\n\n// IDEM GENERIQUE\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(3) + Chaine(4) + Radio(5) + Artist(6) + Titre(7) + Album(8) + Label(9) + Cover(10) + Composer (11) + Orchestre (12) + Chef (13) + Year (14)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion = moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion = moment(start).format('HH[h]mm');\nvar now_playing = msg.duree + \"|\" + msg.chaine + \"|\" + msg.radio + \"|\" + msg.artist + \"|\" + msg.title + \"|\" + msg.album + \"|\" + msg.label + \"|\" + msg.cover + \"|\" + msg.composer + \"|\" + msg.orchestre + \"|\" + msg.chef + \"|\" + msg.year;\nmsg.now_playing_liked = timestamp + \"|\" + date_diffusion + \"|\" + heure_diffusion + \"|\" + now_playing;\n\n// Formatage des Meta IceCast: (Composer) / Artiste - Titre \nmsg.title_ice = msg.title;\nmsg.composer_ice = msg.composer;\n//\n//Si composer et artiste ne sont pas vides on ajoute le separateur / pour delimiter composer et artiste ...\nif ((msg.composer !== \"\") && (msg.artist !== \"\")) {\n  msg.composer_ice = msg.composer + \" / \"\n}\n\nmsg.url = \"http://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\" + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent(msg.composer_ice) + encodeURIComponent(msg.artist) + \"%20-%20\" + encodeURIComponent(msg.title_ice) //+ encodeURIComponent (msg.album);\n\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover + Orchestre + Chef + Year  (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing = now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":180,"wires":[["f843460a.6ad2c8","7b4bcbad.904124"]]},{"id":"8a32c287.ba33e","type":"ui_template","z":"c43f5f8e.e4ee6","group":"b572a7ac.5cbd38","name":"Preload JS / CSS","order":11,"width":"1","height":"0","format":"<link rel=\"stylesheet\" type=\"text/css\" href=\"/css/musique.css\">\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css\" integrity=\"sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw==\" crossorigin=\"anonymous\" />\n<script src=\"/script/musique.js\" type=\"text/javascript\"></script>\n\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":1170,"y":100,"wires":[[]]},{"id":"d83f8fd6.e7e75","type":"http request","z":"c43f5f8e.e4ee6","d":true,"name":"Update Meta IceCast","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1440,"y":660,"wires":[["4b4c260d.5ae848"]]},{"id":"4b4c260d.5ae848","type":"debug","z":"c43f5f8e.e4ee6","d":true,"name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"url","targetType":"msg","statusVal":"","statusType":"auto","x":1620,"y":660,"wires":[]},{"id":"ef01a2d0.63d47","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.my_onclickfunction = \"myfunction()\";\nvar radio_short= \"Baroque\";\nmsg.id_audio = \"audio_\"+ radio_short;\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"La Baroque\";// affichage UI\nmsg.iceradio = \"francemusiquebaroque\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique Baroque\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":260,"wires":[["374f427b.05958e"]]},{"id":"7b4bcbad.904124","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":660,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"e683e6e5.ad0758","type":"function","z":"c43f5f8e.e4ee6","name":"To Logs","func":"//var timestamp = new Date().toISOString();\n//payload = timestamp +\"|\"+ msg.now_playing;\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\nvar moment = global.get('moment');\nvar diffusion = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(diffusion).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(diffusion).format('HH[h]mm'); \nmsg.payload = diffusion +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ msg.now_playing;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1400,"y":1020,"wires":[["7608f9d8.0b2b88"]],"info":"**Pour éviter de transmettre un payload** de metadata sur MQQT out dés qu'il y a de nouvelles meta qui se retrouvent dans les logs de l'extension (sans que cela soit bloquant) on pourrait utiliser plus proprement ce node pour faire un routage en lui adjoignant 2 sorties et un test de chaque message en fonction de son topic:\n\n- Si le topic est roon/HQPlayer/browse/internet_radio c'est une commande de lancement de radio et on transmet le message en output 1 au node MQTT.\n\n- Sinon, on fait la concatenation pour les logs et on transmet en output 2 vers le module d'export.\n\nVoir: [https://nodered.org/docs/user-guide/writing-functions]()\n\n> if (msg.payload === \"topicMQTT\") {\n>    return [ msg, null ];\n> } else {\n>    return [ null, msg ];\n> }"},{"id":"7608f9d8.0b2b88","type":"file","z":"c43f5f8e.e4ee6","d":true,"name":"Export Fichier Log","filename":"/home/bruno/musique.log","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"utf8","x":1630,"y":1020,"wires":[[]]},{"id":"f488d40.786c13","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"Classique Easy\";// affichage UI\nmsg.iceradio = \"francemusiqueeasy\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique Easy\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":300,"wires":[["b29d0f92.8fc44"]]},{"id":"facacb07.1a3bc8","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"Classique Plus\";// affichage UI\nmsg.iceradio = \"francemusiqueplus\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique Plus\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":340,"wires":[["b8cc3a84.6b0308"]]},{"id":"4d0c8d71.d056d4","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"Concerts\";// affichage UI\nmsg.iceradio = \"francemusiqueconcerts\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique Concerts\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":380,"wires":[["c370384e.5f4d68"]]},{"id":"1626df44.ab5ea1","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"La Jazz\";// affichage UI\nmsg.iceradio = \"francemusiquejazz\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique Jazz\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":420,"wires":[["39ad9832.95be78"]]},{"id":"8aa0bfa3.8adf4","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"La Contemporaine\";// affichage UI\nmsg.iceradio = \"francemusiquecontemporaine\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique Contemporaine\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":460,"wires":[["ddcc8c97.7d2f"]]},{"id":"69121beb.bf58b4","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"Musiques du Monde\";// affichage UI\nmsg.iceradio = \"francemusiqueocora\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique Ocora\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":500,"wires":[["fc86b239.7923d"]]},{"id":"4f62815a.51472","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"Musiques de film\";// affichage UI\nmsg.iceradio = \"francemusiquelabo\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique la B.O.\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":540,"wires":[["6ae7086f.e0ea58"]]},{"id":"18d1e50.f9a281b","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE LA BAROQUE\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"Opéra\";// affichage UI\nmsg.iceradio = \"francemusiqueopera\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique Opera\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":580,"wires":[["45e56baf.59cb64"]]},{"id":"245200d6.571f6","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":698,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"25e5fc01.4ffaf4","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":738,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"57358aad.adb7c4","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":778,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"48480c75.e83f34","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":820,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"7996a0ce.5cbcd","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":858,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"2c8b983b.7dcd48","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":898,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"5005380a.e04fb8","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":938,"wires":[["d83f8fd6.e7e75"]]},{"id":"b283a79c.67f048","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":980,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"1b9b37f3.2016d8","type":"rbe","z":"c43f5f8e.e4ee6","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":1150,"y":1018,"wires":[["e683e6e5.ad0758","d83f8fd6.e7e75"]]},{"id":"4ac23bc8.6b3c04","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE (main)\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"La Radio\";// affichage UI\nmsg.iceradio = \"francemusique\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique\"; // Accés MQTT à la radio sur roon\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":140,"wires":[["d17826a9.82db18"]]},{"id":"c90fa730.e3f7c8","type":"function","z":"c43f5f8e.e4ee6","name":"","func":"// FRANCE MUSIQUE (main)\nmsg.chaine = \"France Musique\"; // affichahe logs\nmsg.chaine_short = \"musique\"; // abreviation\nmsg.radio = \"La Radio\";// affichage UI\nmsg.iceradio = \"francemusique\";// suffixe du mountpoint url ice pour insertion meta\nmsg.roonradio = \"France Musique\"; // Accés MQTT à la radio sur roon\n\nreturn msg;\n/* \nURL serveur Ice Cast pour insertion meta:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURLs audio dans classique.js, sans meta, pour écoute hors ROON\nvar url_musique =\"http://icecast.radiofrance.fr/francemusique-hifi.aac\";\nvar url_baroque = \"http://icecast.radiofrance.fr/francemusiquebaroque-hifi.aac\";\nvar url_easy = \"http://icecast.radiofrance.fr/francemusiqueeasyclassique-hifi.aac\";\nvar url_plus = \"http://icecast.radiofrance.fr/francemusiqueclassiqueplus-hifi.aac\";\nvar url_opera = \"http://icecast.radiofrance.fr/francemusiqueopera-hifi.aac\";\nvar url_ocora = \"http://icecast.radiofrance.fr/francemusiqueocoramonde-hifi.aac\";\nvar url_concerts = \"http://icecast.radiofrance.fr/francemusiqueconcertsradiofrance-hifi.aac\";\nvar url_jazz = \"http://icecast.radiofrance.fr/francemusiquelajazz-hifi.aac\";\nvar url_contemporaine = \"http://icecast.radiofrance.fr/francemusiquelacontemporaine-hifi.aac\";\nvar url_labo = \"http://icecast.radiofrance.fr/francemusiquelabo-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":180,"wires":[["840778a5.3483b8"]]},{"id":"45e56baf.59cb64","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","env":[],"x":960,"y":580,"wires":[["9bccbb9e.74e8b8","1b9b37f3.2016d8"]]},{"id":"6ae7086f.e0ea58","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","env":[],"x":960,"y":540,"wires":[["39911df3.06dc52","b283a79c.67f048"]]},{"id":"fc86b239.7923d","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","x":960,"y":500,"wires":[["5005380a.e04fb8","433e7136.508a9"]]},{"id":"ddcc8c97.7d2f","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","x":960,"y":460,"wires":[["2c8b983b.7dcd48","b66512a5.d3321"]]},{"id":"39ad9832.95be78","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","x":960,"y":420,"wires":[["7996a0ce.5cbcd","7532cc8a.dccb54"]]},{"id":"c370384e.5f4d68","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","x":960,"y":380,"wires":[["48480c75.e83f34","dd6203b5.970da"]]},{"id":"b8cc3a84.6b0308","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","x":960,"y":340,"wires":[["57358aad.adb7c4","f94eded4.1bde6"]]},{"id":"b29d0f92.8fc44","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","x":960,"y":300,"wires":[["25e5fc01.4ffaf4","822e2981.5a10f8"]]},{"id":"374f427b.05958e","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","env":[],"x":960,"y":260,"wires":[["245200d6.571f6","83ea9d2f.830a7"]]},{"id":"d17826a9.82db18","type":"subflow:8c03cacb.961ff8","z":"c43f5f8e.e4ee6","name":"","env":[],"x":960,"y":140,"wires":[["f843460a.6ad2c8","7b4bcbad.904124"]]},{"id":"933fd784.19fd58","type":"function","z":"56eea0e0.0ebaa","name":"To ROON","func":"msg.radio_to_roon = msg.payload;\nmsg.payload = \"Live Radio: \" + msg.payload + \" ?\";\nmsg.topic = \"\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":100,"wires":[["7902417a.2da79"]]},{"id":"7902417a.2da79","type":"ui_toast","z":"56eea0e0.0ebaa","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"NON","cancel":"OUI","raw":false,"topic":"","name":"","x":370,"y":100,"wires":[["6da29f0f.d1574"]],"icon":"node-red/light.png"},{"id":"6da29f0f.d1574","type":"function","z":"56eea0e0.0ebaa","name":"Confirm ?","func":"\nif (msg.payload == \"OUI\"){\n    msg.payload = msg.radio_to_roon;\n    return msg;\n} \nelse\n{\n}\n\n    ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":100,"wires":[["4794e0a7.20d45"]]},{"id":"4794e0a7.20d45","type":"mqtt out","z":"56eea0e0.0ebaa","name":"","topic":"roon/HQPlayer/browse/internet_radio","qos":"0","retain":"","broker":"f7803f0d.a47f","x":750,"y":100,"wires":[]},{"id":"3677d639.4d015a","type":"function","z":"56eea0e0.0ebaa","name":"To Liked","func":"msg.now_liked = msg.payload;\nmsg.payload = \"Ajouter aux favoris\";\nmsg.topic = \"\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":260,"wires":[["7d52e419.e6820c"]]},{"id":"7d52e419.e6820c","type":"ui_toast","z":"56eea0e0.0ebaa","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"NON","cancel":"OUI","raw":false,"topic":"","name":"","x":370,"y":260,"wires":[["2b1f76c1.49a35a"]],"icon":"node-red/light.png"},{"id":"2b1f76c1.49a35a","type":"function","z":"56eea0e0.0ebaa","name":"Confirm ?","func":"\nif (msg.payload == \"OUI\"){\n    msg.payload = msg.now_liked;\n    return msg;\n} \nelse\n{\n}\n\n    ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":260,"wires":[["eaa66179.ed0ab"]]},{"id":"eaa66179.ed0ab","type":"file","z":"56eea0e0.0ebaa","name":"Export Fichier Favoris","filename":"/home/bruno/favoris.log","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"utf8","x":700,"y":260,"wires":[["7f9c557c.caa7ec"]]},{"id":"7f9c557c.caa7ec","type":"function","z":"56eea0e0.0ebaa","name":"Extraction données","func":"var html_fields= msg.payload.split(\"|\");\nhtml_fields=  JSON.parse(JSON.stringify(html_fields));\n//msg.payload = JSON.parse(JSON.stringify(html_fields));\n//var mail_fields = [];\n//mail_fields[0] = html_fields[3];\n//mail_fields[1] = html_fields[7];\n\n// Si html_fields(10) qui contient cover ne commence pas par http: on lui ajoute le prefix du serveur sur lequel se trouve l'image:\nif (html_fields[10].substr(0,4) != \"http\"){\nhtml_fields[10] = global.get('url_nr')+html_fields[10]}\n\nmail_fav = \"[Radios] \" + html_fields[6] + \" sur \" + html_fields[4] + \" \" + html_fields[5] + \" !\";\nmsg={\n    payload:html_fields,\n    topic:mail_fav,\n};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":260,"wires":[["3e782f57.462b7"]]},{"id":"3e782f57.462b7","type":"template","z":"56eea0e0.0ebaa","name":"css","field":"payload.style","fieldType":"msg","format":"css","syntax":"mustache","template":"p {\n  font-size: 12px;\n  color: Dimgray;\n  margin-bottom: 0px;\n  margin-top: 0px;\n}\n\n\nh1 {\n \n  font-weight: bold;\n  font-size: 22px;\n  color: DarkGray;\n  margin-bottom: 0px;\n  margin-top: 0px;\n}\n\nh2 {\n  font-weight: bold;\n  font-size: 18px;\n  color: DarkSlateGray;\n  margin-bottom: 0px;\n  margin-top: 0px;\n}\n\nh3 {\n  font-weight: normal;\n  font-size: 16px;\n  color: Dimgray;\n  margin-bottom: 0px;\n  margin-top: 0px;\n}\n\nh3.titre {\n \n  font-weight: normal;\n  font-size: 16px;\n  color: Silver;\n}\n\n\nimg {\n  width: 338px;\n  height: 338px;\n  border-radius: 26px;\n  margin-bottom: 5px;\n}\n\n\n","x":1070,"y":260,"wires":[["c99f1911.2ce868"]]},{"id":"c99f1911.2ce868","type":"template","z":"56eea0e0.0ebaa","name":"html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<head>\n    <style>\n     {{payload.style}}\n    </style>\n</head>\n<body>\n    <p>{{{payload.1}}} à {{{payload.2}}}:</p>\n    <h1>{{{payload.11}}}</h1>\n    <h2>{{{payload.6}}}</h2>\n    <h2>{{{payload.12}}}</h2>\n    <h2>{{{payload.13}}}</h2>\n    <h3>{{{payload.7}}}  ({{{payload.3}}})</h3>\n    <br>\n  <img src=\"{{{payload.10}}}\">\n  <h3>{{{payload.8}}}</h3>\n  <p>{{{payload.9}}} {{{payload.14}}}</p>\n  </body>\n  ","output":"str","x":1190,"y":260,"wires":[["219fd9dd.d0e1c6"]]},{"id":"58709d5f.d73114","type":"comment","z":"56eea0e0.0ebaa","name":"Ajouter un lien youtube ? et un lien sut tous les favoris (page HTML)","info":" - ","x":1170,"y":200,"wires":[]},{"id":"58eda792.abe8c8","type":"switch","z":"56eea0e0.0ebaa","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"roon","vt":"str"},{"t":"eq","v":"liked","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":70,"y":160,"wires":[["933fd784.19fd58"],["3677d639.4d015a"]],"info":"Topic n'a rien a voir avec le topic MQTT on pourrait tout aussi bien avoir Roon, le topic sert a filter pour n'avoir que le payload du send correspondant au bouton cliqué."},{"id":"219fd9dd.d0e1c6","type":"e-mail","z":"56eea0e0.0ebaa","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"bruno.payen@gmail.com, herold75@hotmail.fr","dname":"","x":1460,"y":260,"wires":[]},{"id":"e6655f69.a8158","type":"subflow:56eea0e0.0ebaa","z":"c43f5f8e.e4ee6","name":"","env":[],"x":1460,"y":400,"wires":[]},{"id":"62df359.436d7cc","type":"ui_template","z":"c43f5f8e.e4ee6","group":"de800846.fe2ce8","name":"Clock Toolbar","order":1,"width":0,"height":0,"format":"<script id=\"titleScript\" type=\"text/javascript\">\n\n$(function() {\n    if($('.md-toolbar-tools').length != 0){\n        loadClock();\n    }else setTimeout(loadClock, 500)\n});\n\nfunction loadClock(){\n    $('#clock').remove();\n    var toolbar = $('.md-toolbar-tools');\n    \n    var div = $('<div/>');\n    var p = $('<p/ id=\"clock\">');\n    \n    div.append(p);\n    div[0].style.margin = '5px 5px 5px auto';\n    toolbar.append(div);\n\n    function displayTitle(lh) {\n        p.text(lh); \n    }\n    \n    function upTime() {\n        var d = new Date();\n    \n          p.text (d.toLocaleTimeString([], {timeStyle: 'short'}));\n       // p.text (d.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})):\n    }\n\n    if(document.clockInterval){ \n            clearInterval(document.clockInterval);\n            document.clockInterval = null;\n    }\n        \n    document.clockInterval = setInterval(upTime,1000);\n}\n\n</script>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"global","x":1160,"y":60,"wires":[[]],"info":"Affiche l'heure en format short dans le header du dashboard."},{"id":"4f799cef.7c2804","type":"ui_template","z":"2bb9e260.b0adde","group":"f63c93cf.832d6","name":"Classics","order":1,"width":6,"height":"11","format":"<!--\n================================\nClassics\n================================\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_classics\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_classics\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playclassics()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n<!-- Metadata -->\n <h2 class=\"artiste\">{{msg.artist}}</h2>\n <!-- Lien Liked sur titre avec icone, envoi des meta dans msg.now_playing_liked -->\n <a href=\"#\" title=\"Liked\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}}</h3> ","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":840,"y":80,"wires":[["5e376b1f.ec77d4"]]},{"id":"2693a84d.d4ecd8","type":"function","z":"2bb9e260.b0adde","name":"","func":"// Fonctions générique Le MOUV\n////////////////////////////////////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n\n// Affectation Début, Fin, Durée, Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n\n// Lecture et traitement des Metadata\nvar playing_item = msg.payload.data.now.playing_item.song;\n// Debug console\nif (playing_item) {\nmsg.playing_item_null = \"OK\";\n} else {\nmsg.playing_item_null = \"Mode Program KO\";\n}\n\n/// Test sur song, avec sauvegarde contextuelle des variabales pour qu'elles ne soit pas \"undefined\" lors de la transition et pour éviter le typeerror. \n\nif (playing_item !== null) {\n\n  // Cover (test pour afficgage image locale si l'url de la pochette n'est pas livrée)\n  if (typeof playing_item.cover !== 'undefined' && playing_item.cover !== null) {\n    msg.erreur_cover = \"cover OK\";\n    var cover = playing_item.cover;\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  } else {\n    msg.erreur_cover = \"cover est Undefined ou Null: \" + cover;\n    var cover = \"/images/missing_image_315.png\";\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  }\n  \n   // Artist\n  if (typeof playing_item.subtitle !== 'undefined' && playing_item.subtitle !== null) {\n    msg.erreur_artist = \"artist OK et non null\";\n    var artist = playing_item.subtitle.capitalize();\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  } else {\n    msg.erreur_artist = \"artist Undefined ou null\";\n    var artist = \"\";\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  }\n\n  // Title\n  if (typeof playing_item.title !== 'undefined' && playing_item.title !== null) {\n    msg.erreur_title = \"title OK\";\n    var title = playing_item.title.capitalizeinitial();\n    context.set(\"titlesave\", title);\n    msg.title = title;\n  } else {\n    msg.erreur_title = \"title est Undefined ou Null\";\n    var title=\"\";\n    context.set(\"titlesave\", title);\n    msg.title= title;\n  }\n\n  // Album\n  if (typeof playing_item.album !== 'undefined' && playing_item.album !== null) {\n    msg.erreur_album = \"album OK\";\n    var album = playing_item.album.capitalizeinitial();\n    // on affecte l'album si il est différent du titre sinon on l'oublie\n    if (title.toUpperCase() == album.toUpperCase()){ \n    msg.album_title=\"titre et album sont identiques\";\n    album = \"\";\n    msg.album = album;\n} \n    context.set(\"albumsave\", album);\n    msg.album = album;\n  } else {\n    msg.erreur_album = \"album est Undefined\";\n    var album = \"\";\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  }\n\n  // Label\n  if (typeof playing_item.label !== 'undefined' && playing_item.label !== null) {\n    msg.erreur_label = \"label OK\";\n    var label = \"Label: \" + playing_item.label.toUpperCase();\n    context.set(\"labelsave\", label);\n    msg.label = label;\n    \n  } else {\n    msg.erreur_label = \"label est Undefined\";\n    var label = \"\";\n    context.set(\"labelsave\", label);\n     msg.label = label;\n  }\n  \n} else {\n  msg.cover = context.get(\"coversave\");\n  msg.artist = context.get(\"artistsave\");\n  msg.title = context.get(\"titlesave\");\n  msg.album = context.get(\"albumsave\");\n  msg.label = context.get(\"labelsave\");\n}\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(2) + Chaine(3) + Radio(4) + Artist(5) + Titre(6) + Album(7) + Label(8) + Cover(9)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(start).format('HH[h]mm'); \nvar now_playing= msg.duree +\"|\"+ msg.chaine +\"|\"+msg.radio +\"|\"+msg.artist+\"|\"+msg.title+\"|\"+msg.album+\"|\"+msg.label +\"|\"+ msg.cover;\nmsg.now_playing_liked = timestamp +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ now_playing;\n\n// Formatage des Meta IceCast: Artiste - Titre (/ Album) \nmsg.title_ice = msg.title;\n//Si titre et album ne sont pas vides on ajoute le separateur / pour delimiter l'album\nif ((msg.title !== \"\") && (msg.album!== \"\")) {msg.title_ice = msg.title + \" / \"}\nmsg.url = \"http://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\" + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent (msg.artist) + \"%20-%20\" + encodeURIComponent (msg.title_ice) + encodeURIComponent (msg.album);\n\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing=now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":80,"wires":[["4f799cef.7c2804","11ed6839.31fa08"]]},{"id":"9d5243f8.349f","type":"json","z":"2bb9e260.b0adde","name":"","property":"payload","action":"","pretty":false,"x":390,"y":80,"wires":[["d85c63cd.211be"]]},{"id":"5f52edd4.d53744","type":"http request","z":"2bb9e260.b0adde","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":250,"y":80,"wires":[["9d5243f8.349f"]]},{"id":"ac9b06b1.02ff58","type":"inject","z":"2bb9e260.b0adde","name":"Classics","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A601%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.98","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":80,"y":80,"wires":[["5f52edd4.d53744"]]},{"id":"815a3766.968598","type":"ui_template","z":"2bb9e260.b0adde","group":"f63c93cf.832d6","name":"Preload JS / CSS","order":7,"width":"1","height":"0","format":"<link rel=\"stylesheet\" type=\"text/css\" href=\"/css/mouv.css\">\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css\" integrity=\"sha512-q3eWabyZPc1XTCmF+8/LuE1ozpg5xxn7iO89yfSOd5/oKvyqLngoNGsx8jq92Y8eXJ/IRxQbEC+FGSYxtk2oiw==\" crossorigin=\"anonymous\" />\n<script src=\"/script/mouv.js\" type=\"text/javascript\"></script>","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":870,"y":40,"wires":[[]]},{"id":"aa96240e.a56668","type":"http request","z":"2bb9e260.b0adde","d":true,"name":"Update Meta IceCast","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1280,"y":380,"wires":[["36472c03.0f5d44"]]},{"id":"c2eb13dd.b3f44","type":"inject","z":"2bb9e260.b0adde","name":"DanceHall","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A602%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.98","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":90,"y":120,"wires":[["46a8f3e6.64c8bc"]]},{"id":"46a8f3e6.64c8bc","type":"http request","z":"2bb9e260.b0adde","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":250,"y":120,"wires":[["1211692d.9384d7"]]},{"id":"1211692d.9384d7","type":"json","z":"2bb9e260.b0adde","name":"","property":"payload","action":"","pretty":false,"x":390,"y":120,"wires":[["a1912acf.39e878"]]},{"id":"593a8a1b.ad3a84","type":"function","z":"2bb9e260.b0adde","name":"","func":"// Fonctions générique Le MOUV\n////////////////////////////////////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n\n// Affectation Début, Fin, Durée, Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n\n// Lecture et traitement des Metadata\nvar playing_item = msg.payload.data.now.playing_item.song;\n// Debug console\nif (playing_item) {\nmsg.playing_item_null = \"OK\";\n} else {\nmsg.playing_item_null = \"Mode Program KO\";\n}\n\n/// Test sur song, avec sauvegarde contextuelle des variabales pour qu'elles ne soit pas \"undefined\" lors de la transition et pour éviter le typeerror. \n\nif (playing_item !== null) {\n\n  // Cover (test pour afficgage image locale si l'url de la pochette n'est pas livrée)\n  if (typeof playing_item.cover !== 'undefined' && playing_item.cover !== null) {\n    msg.erreur_cover = \"cover OK\";\n    var cover = playing_item.cover;\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  } else {\n    msg.erreur_cover = \"cover est Undefined ou Null: \" + cover;\n    var cover = \"/images/missing_image_315.png\";\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  }\n  \n   // Artist\n  if (typeof playing_item.subtitle !== 'undefined' && playing_item.subtitle !== null) {\n    msg.erreur_artist = \"artist OK et non null\";\n    var artist = playing_item.subtitle.capitalize();\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  } else {\n    msg.erreur_artist = \"artist Undefined ou null\";\n    var artist = \"\";\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  }\n\n  // Title\n  if (typeof playing_item.title !== 'undefined' && playing_item.title !== null) {\n    msg.erreur_title = \"title OK\";\n    var title = playing_item.title.capitalizeinitial();\n    context.set(\"titlesave\", title);\n    msg.title = title;\n  } else {\n    msg.erreur_title = \"title est Undefined ou Null\";\n    var title=\"\";\n    context.set(\"titlesave\", title);\n    msg.title= title;\n  }\n\n  // Album\n  if (typeof playing_item.album !== 'undefined' && playing_item.album !== null) {\n    msg.erreur_album = \"album OK\";\n    var album = playing_item.album.capitalizeinitial();\n    // on affecte l'album si il est différent du titre sinon on l'oublie\n    if (title.toUpperCase() == album.toUpperCase()){ \n    msg.album_title=\"titre et album sont identiques\";\n    album = \"\";\n    msg.album = album;\n} \n    context.set(\"albumsave\", album);\n    msg.album = album;\n  } else {\n    msg.erreur_album = \"album est Undefined\";\n    var album = \"\";\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  }\n\n  // Label\n  if (typeof playing_item.label !== 'undefined' && playing_item.label !== null) {\n    msg.erreur_label = \"label OK\";\n    var label = \"Label: \" + playing_item.label.toUpperCase();\n    context.set(\"labelsave\", label);\n    msg.label = label;\n    \n  } else {\n    msg.erreur_label = \"label est Undefined\";\n    var label = \"\";\n    context.set(\"labelsave\", label);\n     msg.label = label;\n  }\n  \n} else {\n  msg.cover = context.get(\"coversave\");\n  msg.artist = context.get(\"artistsave\");\n  msg.title = context.get(\"titlesave\");\n  msg.album = context.get(\"albumsave\");\n  msg.label = context.get(\"labelsave\");\n}\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(2) + Chaine(3) + Radio(4) + Artist(5) + Titre(6) + Album(7) + Label(8) + Cover(9)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(start).format('HH[h]mm'); \nvar now_playing= msg.duree +\"|\"+ msg.chaine +\"|\"+msg.radio +\"|\"+msg.artist+\"|\"+msg.title+\"|\"+msg.album+\"|\"+msg.label +\"|\"+ msg.cover;\nmsg.now_playing_liked = timestamp +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ now_playing;\n\n// Formatage des Meta IceCast: Artiste - Titre (/ Album) \nmsg.title_ice = msg.title;\n//Si titre et album ne sont pas vides on ajoute le separateur / pour delimiter l'album\nif ((msg.title !== \"\") && (msg.album!== \"\")) {msg.title_ice = msg.title + \" / \"}\nmsg.url = \"http://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\" + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent (msg.artist) + \"%20-%20\" + encodeURIComponent (msg.title_ice) + encodeURIComponent (msg.album);\n\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing=now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":120,"wires":[["d2fd00b6.1da3a","f032bd29.2b59b"]]},{"id":"d2fd00b6.1da3a","type":"ui_template","z":"2bb9e260.b0adde","group":"f63c93cf.832d6","name":"DanceHall","order":2,"width":6,"height":"11","format":"<!--\n================================\nDanceHall\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_dancehall\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_dancehall\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playdancehall()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"artiste\">{{msg.artist}}</h2>\n <a href=\"#\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":850,"y":120,"wires":[["5e376b1f.ec77d4"]]},{"id":"36472c03.0f5d44","type":"debug","z":"2bb9e260.b0adde","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"url","targetType":"msg","statusVal":"","statusType":"auto","x":1480,"y":380,"wires":[]},{"id":"19e61781.374f08","type":"comment","z":"2bb9e260.b0adde","name":"pipe delimited pour favoris liked et logs ","info":"","x":1390,"y":580,"wires":[]},{"id":"85dc6058.983eb","type":"inject","z":"2bb9e260.b0adde","name":"RNB","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A603%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.98","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":70,"y":160,"wires":[["337d6a37.7313c6"]]},{"id":"337d6a37.7313c6","type":"http request","z":"2bb9e260.b0adde","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":250,"y":160,"wires":[["5f5b75d4.94ee4c"]]},{"id":"5f5b75d4.94ee4c","type":"json","z":"2bb9e260.b0adde","name":"","property":"payload","action":"","pretty":false,"x":390,"y":160,"wires":[["b87c6a5f.bf1198"]]},{"id":"cc44d340.f9b07","type":"function","z":"2bb9e260.b0adde","name":"","func":"// Fonctions générique Le MOUV\n////////////////////////////////////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n\n// Affectation Début, Fin, Durée, Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n\n// Lecture et traitement des Metadata\nvar playing_item = msg.payload.data.now.playing_item.song;\n// Debug console\nif (playing_item) {\nmsg.playing_item_null = \"OK\";\n} else {\nmsg.playing_item_null = \"Mode Program KO\";\n}\n\n/// Test sur song, avec sauvegarde contextuelle des variabales pour qu'elles ne soit pas \"undefined\" lors de la transition et pour éviter le typeerror. \n\nif (playing_item !== null) {\n\n  // Cover (test pour afficgage image locale si l'url de la pochette n'est pas livrée)\n  if (typeof playing_item.cover !== 'undefined' && playing_item.cover !== null) {\n    msg.erreur_cover = \"cover OK\";\n    var cover = playing_item.cover;\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  } else {\n    msg.erreur_cover = \"cover est Undefined ou Null: \" + cover;\n    var cover = \"/images/missing_image_315.png\";\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  }\n  \n   // Artist\n  if (typeof playing_item.subtitle !== 'undefined' && playing_item.subtitle !== null) {\n    msg.erreur_artist = \"artist OK et non null\";\n    var artist = playing_item.subtitle.capitalize();\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  } else {\n    msg.erreur_artist = \"artist Undefined ou null\";\n    var artist = \"\";\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  }\n\n  // Title\n  if (typeof playing_item.title !== 'undefined' && playing_item.title !== null) {\n    msg.erreur_title = \"title OK\";\n    var title = playing_item.title.capitalizeinitial();\n    context.set(\"titlesave\", title);\n    msg.title = title;\n  } else {\n    msg.erreur_title = \"title est Undefined ou Null\";\n    var title=\"\";\n    context.set(\"titlesave\", title);\n    msg.title= title;\n  }\n\n  // Album\n  if (typeof playing_item.album !== 'undefined' && playing_item.album !== null) {\n    msg.erreur_album = \"album OK\";\n    var album = playing_item.album.capitalizeinitial();\n    // on affecte l'album si il est différent du titre sinon on l'oublie\n    if (title.toUpperCase() == album.toUpperCase()){ \n    msg.album_title=\"titre et album sont identiques\";\n    album = \"\";\n    msg.album = album;\n} \n    context.set(\"albumsave\", album);\n    msg.album = album;\n  } else {\n    msg.erreur_album = \"album est Undefined\";\n    var album = \"\";\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  }\n\n  // Label\n  if (typeof playing_item.label !== 'undefined' && playing_item.label !== null) {\n    msg.erreur_label = \"label OK\";\n    var label = \"Label: \" + playing_item.label.toUpperCase();\n    context.set(\"labelsave\", label);\n    msg.label = label;\n    \n  } else {\n    msg.erreur_label = \"label est Undefined\";\n    var label = \"\";\n    context.set(\"labelsave\", label);\n     msg.label = label;\n  }\n  \n} else {\n  msg.cover = context.get(\"coversave\");\n  msg.artist = context.get(\"artistsave\");\n  msg.title = context.get(\"titlesave\");\n  msg.album = context.get(\"albumsave\");\n  msg.label = context.get(\"labelsave\");\n}\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(2) + Chaine(3) + Radio(4) + Artist(5) + Titre(6) + Album(7) + Label(8) + Cover(9)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(start).format('HH[h]mm'); \nvar now_playing= msg.duree +\"|\"+ msg.chaine +\"|\"+msg.radio +\"|\"+msg.artist+\"|\"+msg.title+\"|\"+msg.album+\"|\"+msg.label +\"|\"+ msg.cover;\nmsg.now_playing_liked = timestamp +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ now_playing;\n\n// Formatage des Meta IceCast: Artiste - Titre (/ Album) \nmsg.title_ice = msg.title;\n//Si titre et album ne sont pas vides on ajoute le separateur / pour delimiter l'album\nif ((msg.title !== \"\") && (msg.album!== \"\")) {msg.title_ice = msg.title + \" / \"}\nmsg.url = \"http://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\" + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent (msg.artist) + \"%20-%20\" + encodeURIComponent (msg.title_ice) + encodeURIComponent (msg.album);\n\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing=now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":160,"wires":[["ea2ce0f2.7bf2d","9de28919.6695a8"]]},{"id":"ea2ce0f2.7bf2d","type":"ui_template","z":"2bb9e260.b0adde","group":"f63c93cf.832d6","name":"RnB","order":2,"width":6,"height":"11","format":"<!--\n================================\nRnB\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_rnb\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_rnb\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playrnb()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"artiste\">{{msg.artist}}</h2>\n <a href=\"#\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":830,"y":160,"wires":[["5e376b1f.ec77d4"]]},{"id":"e1e17a01.ad7b38","type":"inject","z":"2bb9e260.b0adde","name":"Rap US","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A604%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.98","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":80,"y":200,"wires":[["3f8f38d5.a87658"]]},{"id":"3f8f38d5.a87658","type":"http request","z":"2bb9e260.b0adde","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":250,"y":200,"wires":[["5ccbdd05.ef15f4"]]},{"id":"5ccbdd05.ef15f4","type":"json","z":"2bb9e260.b0adde","name":"","property":"payload","action":"","pretty":false,"x":390,"y":200,"wires":[["e40edaf4.f7ec38"]]},{"id":"fa384da.befdeb","type":"function","z":"2bb9e260.b0adde","name":"","func":"// Fonctions générique Le MOUV\n////////////////////////////////////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n\n// Affectation Début, Fin, Durée, Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n\n// Lecture et traitement des Metadata\nvar playing_item = msg.payload.data.now.playing_item.song;\n// Debug console\nif (playing_item) {\nmsg.playing_item_null = \"OK\";\n} else {\nmsg.playing_item_null = \"Mode Program KO\";\n}\n\n/// Test sur song, avec sauvegarde contextuelle des variabales pour qu'elles ne soit pas \"undefined\" lors de la transition et pour éviter le typeerror. \n\nif (playing_item !== null) {\n\n  // Cover (test pour afficgage image locale si l'url de la pochette n'est pas livrée)\n  if (typeof playing_item.cover !== 'undefined' && playing_item.cover !== null) {\n    msg.erreur_cover = \"cover OK\";\n    var cover = playing_item.cover;\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  } else {\n    msg.erreur_cover = \"cover est Undefined ou Null: \" + cover;\n    var cover = \"/images/missing_image_315.png\";\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  }\n  \n   // Artist\n  if (typeof playing_item.subtitle !== 'undefined' && playing_item.subtitle !== null) {\n    msg.erreur_artist = \"artist OK et non null\";\n    var artist = playing_item.subtitle.capitalize();\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  } else {\n    msg.erreur_artist = \"artist Undefined ou null\";\n    var artist = \"\";\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  }\n\n  // Title\n  if (typeof playing_item.title !== 'undefined' && playing_item.title !== null) {\n    msg.erreur_title = \"title OK\";\n    var title = playing_item.title.capitalizeinitial();\n    context.set(\"titlesave\", title);\n    msg.title = title;\n  } else {\n    msg.erreur_title = \"title est Undefined ou Null\";\n    var title=\"\";\n    context.set(\"titlesave\", title);\n    msg.title= title;\n  }\n\n  // Album\n  if (typeof playing_item.album !== 'undefined' && playing_item.album !== null) {\n    msg.erreur_album = \"album OK\";\n    var album = playing_item.album.capitalizeinitial();\n    // on affecte l'album si il est différent du titre sinon on l'oublie\n    if (title.toUpperCase() == album.toUpperCase()){ \n    msg.album_title=\"titre et album sont identiques\";\n    album = \"\";\n    msg.album = album;\n} \n    context.set(\"albumsave\", album);\n    msg.album = album;\n  } else {\n    msg.erreur_album = \"album est Undefined\";\n    var album = \"\";\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  }\n\n  // Label\n  if (typeof playing_item.label !== 'undefined' && playing_item.label !== null) {\n    msg.erreur_label = \"label OK\";\n    var label = \"Label: \" + playing_item.label.toUpperCase();\n    context.set(\"labelsave\", label);\n    msg.label = label;\n    \n  } else {\n    msg.erreur_label = \"label est Undefined\";\n    var label = \"\";\n    context.set(\"labelsave\", label);\n     msg.label = label;\n  }\n  \n} else {\n  msg.cover = context.get(\"coversave\");\n  msg.artist = context.get(\"artistsave\");\n  msg.title = context.get(\"titlesave\");\n  msg.album = context.get(\"albumsave\");\n  msg.label = context.get(\"labelsave\");\n}\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(2) + Chaine(3) + Radio(4) + Artist(5) + Titre(6) + Album(7) + Label(8) + Cover(9)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(start).format('HH[h]mm'); \nvar now_playing= msg.duree +\"|\"+ msg.chaine +\"|\"+msg.radio +\"|\"+msg.artist+\"|\"+msg.title+\"|\"+msg.album+\"|\"+msg.label +\"|\"+ msg.cover;\nmsg.now_playing_liked = timestamp +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ now_playing;\n\n// Formatage des Meta IceCast: Artiste - Titre (/ Album) \nmsg.title_ice = msg.title;\n//Si titre et album ne sont pas vides on ajoute le separateur / pour delimiter l'album\nif ((msg.title !== \"\") && (msg.album!== \"\")) {msg.title_ice = msg.title + \" / \"}\nmsg.url = \"http://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\" + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent (msg.artist) + \"%20-%20\" + encodeURIComponent (msg.title_ice) + encodeURIComponent (msg.album);\n\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing=now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":200,"wires":[["6b1afa71.79f934","8ff09507.5f99d8"]]},{"id":"6b1afa71.79f934","type":"ui_template","z":"2bb9e260.b0adde","group":"f63c93cf.832d6","name":"Rap US","order":2,"width":6,"height":"11","format":"<!--\n================================\nRapUS\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_rapus\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_rapus\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playrapus()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"artiste\">{{msg.artist}}</h2>\n <a href=\"#\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":840,"y":200,"wires":[["5e376b1f.ec77d4"]]},{"id":"9c33e4e.f395d18","type":"inject","z":"2bb9e260.b0adde","name":"Rap FR","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A605%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.98","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":80,"y":240,"wires":[["468f53e9.70367c"]]},{"id":"468f53e9.70367c","type":"http request","z":"2bb9e260.b0adde","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":250,"y":240,"wires":[["11a32abe.cd1e25"]]},{"id":"11a32abe.cd1e25","type":"json","z":"2bb9e260.b0adde","name":"","property":"payload","action":"","pretty":false,"x":390,"y":240,"wires":[["9f365586.ea5ff8"]]},{"id":"5b608419.3e4d2c","type":"function","z":"2bb9e260.b0adde","name":"","func":"// Fonctions générique Le MOUV\n////////////////////////////////////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n\n// Affectation Début, Fin, Durée, Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n\n// Lecture et traitement des Metadata\nvar playing_item = msg.payload.data.now.playing_item.song;\n// Debug console\nif (playing_item) {\nmsg.playing_item_null = \"OK\";\n} else {\nmsg.playing_item_null = \"Mode Program KO\";\n}\n\n/// Test sur song, avec sauvegarde contextuelle des variabales pour qu'elles ne soit pas \"undefined\" lors de la transition et pour éviter le typeerror. \n\nif (playing_item !== null) {\n\n  // Cover (test pour afficgage image locale si l'url de la pochette n'est pas livrée)\n  if (typeof playing_item.cover !== 'undefined' && playing_item.cover !== null) {\n    msg.erreur_cover = \"cover OK\";\n    var cover = playing_item.cover;\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  } else {\n    msg.erreur_cover = \"cover est Undefined ou Null: \" + cover;\n    var cover = \"/images/missing_image_315.png\";\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  }\n  \n   // Artist\n  if (typeof playing_item.subtitle !== 'undefined' && playing_item.subtitle !== null) {\n    msg.erreur_artist = \"artist OK et non null\";\n    var artist = playing_item.subtitle.capitalize();\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  } else {\n    msg.erreur_artist = \"artist Undefined ou null\";\n    var artist = \"\";\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  }\n\n  // Title\n  if (typeof playing_item.title !== 'undefined' && playing_item.title !== null) {\n    msg.erreur_title = \"title OK\";\n    var title = playing_item.title.capitalizeinitial();\n    context.set(\"titlesave\", title);\n    msg.title = title;\n  } else {\n    msg.erreur_title = \"title est Undefined ou Null\";\n    var title=\"\";\n    context.set(\"titlesave\", title);\n    msg.title= title;\n  }\n\n  // Album\n  if (typeof playing_item.album !== 'undefined' && playing_item.album !== null) {\n    msg.erreur_album = \"album OK\";\n    var album = playing_item.album.capitalizeinitial();\n    // on affecte l'album si il est différent du titre sinon on l'oublie\n    if (title.toUpperCase() == album.toUpperCase()){ \n    msg.album_title=\"titre et album sont identiques\";\n    album = \"\";\n    msg.album = album;\n} \n    context.set(\"albumsave\", album);\n    msg.album = album;\n  } else {\n    msg.erreur_album = \"album est Undefined\";\n    var album = \"\";\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  }\n\n  // Label\n  if (typeof playing_item.label !== 'undefined' && playing_item.label !== null) {\n    msg.erreur_label = \"label OK\";\n    var label = \"Label: \" + playing_item.label.toUpperCase();\n    context.set(\"labelsave\", label);\n    msg.label = label;\n    \n  } else {\n    msg.erreur_label = \"label est Undefined\";\n    var label = \"\";\n    context.set(\"labelsave\", label);\n     msg.label = label;\n  }\n  \n} else {\n  msg.cover = context.get(\"coversave\");\n  msg.artist = context.get(\"artistsave\");\n  msg.title = context.get(\"titlesave\");\n  msg.album = context.get(\"albumsave\");\n  msg.label = context.get(\"labelsave\");\n}\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(2) + Chaine(3) + Radio(4) + Artist(5) + Titre(6) + Album(7) + Label(8) + Cover(9)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(start).format('HH[h]mm'); \nvar now_playing= msg.duree +\"|\"+ msg.chaine +\"|\"+msg.radio +\"|\"+msg.artist+\"|\"+msg.title+\"|\"+msg.album+\"|\"+msg.label +\"|\"+ msg.cover;\nmsg.now_playing_liked = timestamp +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ now_playing;\n\n// Formatage des Meta IceCast: Artiste - Titre (/ Album) \nmsg.title_ice = msg.title;\n//Si titre et album ne sont pas vides on ajoute le separateur / pour delimiter l'album\nif ((msg.title !== \"\") && (msg.album!== \"\")) {msg.title_ice = msg.title + \" / \"}\nmsg.url = \"http://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\" + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent (msg.artist) + \"%20-%20\" + encodeURIComponent (msg.title_ice) + encodeURIComponent (msg.album);\n\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing=now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":240,"wires":[["916219b7.b1c2a8","afc86f5e.fb867"]]},{"id":"916219b7.b1c2a8","type":"ui_template","z":"2bb9e260.b0adde","group":"f63c93cf.832d6","name":"Rap FR","order":2,"width":6,"height":"11","format":"<!--\n================================\nRapfr\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_rapfr\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_rapfr\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playrapfr()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"artiste\">{{msg.artist}}</h2>\n <a href=\"#\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":840,"y":240,"wires":[["5e376b1f.ec77d4"]]},{"id":"a4819f62.0b3bf","type":"inject","z":"2bb9e260.b0adde","name":"Kids","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A606%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.98","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":70,"y":280,"wires":[["14222541.a49beb"]]},{"id":"14222541.a49beb","type":"http request","z":"2bb9e260.b0adde","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":250,"y":280,"wires":[["83c1fa67.406e28"]]},{"id":"83c1fa67.406e28","type":"json","z":"2bb9e260.b0adde","name":"","property":"payload","action":"","pretty":false,"x":390,"y":280,"wires":[["2fd87caa.91c444"]]},{"id":"2dd8d175.48b22e","type":"function","z":"2bb9e260.b0adde","name":"","func":"// Fonctions générique Le MOUV\n////////////////////////////////////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n\n// Affectation Début, Fin, Durée, Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n\n// Lecture et traitement des Metadata\nvar playing_item = msg.payload.data.now.playing_item.song;\n// Debug console\nif (playing_item) {\nmsg.playing_item_null = \"OK\";\n} else {\nmsg.playing_item_null = \"Mode Program KO\";\n}\n\n/// Test sur song, avec sauvegarde contextuelle des variabales pour qu'elles ne soit pas \"undefined\" lors de la transition et pour éviter le typeerror. \n\nif (playing_item !== null) {\n\n  // Cover (test pour afficgage image locale si l'url de la pochette n'est pas livrée)\n  if (typeof playing_item.cover !== 'undefined' && playing_item.cover !== null) {\n    msg.erreur_cover = \"cover OK\";\n    var cover = playing_item.cover;\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  } else {\n    msg.erreur_cover = \"cover est Undefined ou Null: \" + cover;\n    var cover = \"/images/missing_image_315.png\";\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  }\n  \n   // Artist\n  if (typeof playing_item.subtitle !== 'undefined' && playing_item.subtitle !== null) {\n    msg.erreur_artist = \"artist OK et non null\";\n    var artist = playing_item.subtitle.capitalize();\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  } else {\n    msg.erreur_artist = \"artist Undefined ou null\";\n    var artist = \"\";\n    context.set(\"artistsave\", artist);\n    msg.artist = artist;\n  }\n\n  // Title\n  if (typeof playing_item.title !== 'undefined' && playing_item.title !== null) {\n    msg.erreur_title = \"title OK\";\n    var title = playing_item.title.capitalizeinitial();\n    context.set(\"titlesave\", title);\n    msg.title = title;\n  } else {\n    msg.erreur_title = \"title est Undefined ou Null\";\n    var title=\"\";\n    context.set(\"titlesave\", title);\n    msg.title= title;\n  }\n\n  // Album\n  if (typeof playing_item.album !== 'undefined' && playing_item.album !== null) {\n    msg.erreur_album = \"album OK\";\n    var album = playing_item.album.capitalizeinitial();\n    // on affecte l'album si il est différent du titre sinon on l'oublie\n    if (title.toUpperCase() == album.toUpperCase()){ \n    msg.album_title=\"titre et album sont identiques\";\n    album = \"\";\n    msg.album = album;\n} \n    context.set(\"albumsave\", album);\n    msg.album = album;\n  } else {\n    msg.erreur_album = \"album est Undefined\";\n    var album = \"\";\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  }\n\n  // Label\n  if (typeof playing_item.label !== 'undefined' && playing_item.label !== null) {\n    msg.erreur_label = \"label OK\";\n    var label = \"Label: \" + playing_item.label.toUpperCase();\n    context.set(\"labelsave\", label);\n    msg.label = label;\n    \n  } else {\n    msg.erreur_label = \"label est Undefined\";\n    var label = \"\";\n    context.set(\"labelsave\", label);\n     msg.label = label;\n  }\n  \n} else {\n  msg.cover = context.get(\"coversave\");\n  msg.artist = context.get(\"artistsave\");\n  msg.title = context.get(\"titlesave\");\n  msg.album = context.get(\"albumsave\");\n  msg.label = context.get(\"labelsave\");\n}\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(2) + Chaine(3) + Radio(4) + Artist(5) + Titre(6) + Album(7) + Label(8) + Cover(9)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(start).format('HH[h]mm'); \nvar now_playing= msg.duree +\"|\"+ msg.chaine +\"|\"+msg.radio +\"|\"+msg.artist+\"|\"+msg.title+\"|\"+msg.album+\"|\"+msg.label +\"|\"+ msg.cover;\nmsg.now_playing_liked = timestamp +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ now_playing;\n\n// Formatage des Meta IceCast: Artiste - Titre (/ Album) \nmsg.title_ice = msg.title;\n//Si titre et album ne sont pas vides on ajoute le separateur / pour delimiter l'album\nif ((msg.title !== \"\") && (msg.album!== \"\")) {msg.title_ice = msg.title + \" / \"}\nmsg.url = \"http://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\" + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent (msg.artist) + \"%20-%20\" + encodeURIComponent (msg.title_ice) + encodeURIComponent (msg.album);\n\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing=now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":280,"wires":[["d4bebef5.7ac7","3ede1e3e.8f0a82"]]},{"id":"d4bebef5.7ac7","type":"ui_template","z":"2bb9e260.b0adde","group":"f63c93cf.832d6","name":"Kids","order":2,"width":6,"height":"11","format":"<!--\n================================\nKids\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_kids\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_kids\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playkids()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"artiste\">{{msg.artist}}</h2>\n <a href=\"#\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":850,"y":280,"wires":[["5e376b1f.ec77d4"]]},{"id":"c7db827d.b3477","type":"inject","z":"2bb9e260.b0adde","name":"100% Mix","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A75%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"4.98","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":90,"y":320,"wires":[["172e1409.7f13ec"]]},{"id":"172e1409.7f13ec","type":"http request","z":"2bb9e260.b0adde","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":250,"y":320,"wires":[["f2f90e44.26e78"]]},{"id":"f2f90e44.26e78","type":"json","z":"2bb9e260.b0adde","name":"","property":"payload","action":"","pretty":false,"x":390,"y":320,"wires":[["5d1af6b.79eac08"]]},{"id":"9a66feff.c8c5c","type":"function","z":"2bb9e260.b0adde","name":"","func":"// Fonctions générique Le MOUV\n////////////////////////////////////////////////////////////////\n\n// Chargement library moment\nvar moment = global.get('moment');\n\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\n\n// Méthode pour capitaliser chacune des intiales des mots, en passant d'abord tout en minuscule.\nString.prototype.capitalize = function() {\n  return this.toLocaleLowerCase().replace(/(^|\\s)([a-z])/g, function(m, p1, p2) {\n    return p1 + p2.toUpperCase();\n  });\n}\n\n// Affectation Début, Fin, Durée, Test sur debut different de 0, si plus de données on reprend les données sauvegardées\nvar debut = msg.payload.data.now.playing_item.start_time;\nvar fin = msg.payload.data.now.playing_item.end_time;\nvar time = fin - debut;\n\nif (debut !== 0) {\n  var start = new Date(debut * 1000);\n  context.set(\"startsave\", start);\n  var end = new Date(fin * 1000);\n  context.set(\"endsave\", end);\n  var duree = new Date(time * 1000);\n  context.set(\"dureesave\", duree);\n  msg.start = moment(start).format(\"HH[h]mm\");\n  msg.end = moment(end).format(\"HH[h]mm\");\n  msg.duree = moment.duration(duree).format(\"hh:mm:ss\");\n} else {\n  msg.start = moment(context.get(\"startsave\")).format(\"HH[h]mm\");\n  msg.end = moment(context.get(\"endsave\")).format(\"HH[h]mm\");\n  msg.duree = moment.duration(context.get(\"dureesave\")).format(\"hh:mm:ss\");\n}\n\n// Lecture et traitement des Metadata\nvar playing_item = msg.payload.data.now.playing_item.song;\n// Debug console\nif (playing_item) {\nmsg.playing_item_null = \"OK\";\n} else {\nmsg.playing_item_null = \"Mode Program KO\";\n}\n\n/// Test sur song, avec sauvegarde contextuelle des variabales pour qu'elles ne soit pas \"undefined\" lors de la transition et pour éviter le typeerror. \n\nif (playing_item !== null) {\n\n  // Cover (test pour afficgage image locale si l'url de la pochette n'est pas livrée)\n  if (typeof playing_item.cover !== 'undefined' && playing_item.cover !== null) {\n    msg.erreur_cover = \"cover OK\";\n    var cover = playing_item.cover;\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  } else {\n    msg.erreur_cover = \"cover est Undefined ou Null: \" + cover;\n    var cover = \"/images/missing_image_315.png\";\n    context.set(\"coversave\", cover);\n    msg.cover = cover;\n  }\n  \n   // Artist\n  if (typeof playing_item.subtitle !== 'undefined' && playing_item.subtitle !== null) {\n    msg.erreur_artist = \"artist OK et non null\";\n    var artist = playing_item.subtitle.capitalize();\n    context.set(\"artistsave\", artist);\n    msg.artist = \"\";\n  } else {\n    msg.erreur_artist = \"artist Undefined ou null\";\n    var artist = \"\";\n    context.set(\"artistsave\", artist);\n    msg.artist = \"\";\n  }\n\n  // Title\n  if (typeof playing_item.title !== 'undefined' && playing_item.title !== null) {\n    msg.erreur_title = \"title OK\";\n    var title = playing_item.title.capitalizeinitial();\n    context.set(\"titlesave\", title);\n    msg.title = \"DJ: \"+title;\n  } else {\n    msg.erreur_title = \"title est Undefined ou Null\";\n    var title=\"\";\n    context.set(\"titlesave\", title);\n    msg.title = \"DJ: \"+title;\n  }\n\n  // Album\n  if (typeof playing_item.album !== 'undefined' && playing_item.album !== null) {\n    msg.erreur_album = \"album OK\";\n    var album = playing_item.album.capitalizeinitial();\n    // on affecte l'album si il est différent du titre sinon on l'oublie\n    if (title.toUpperCase() == album.toUpperCase()){ \n    msg.album_title=\"titre et album sont identiques\";\n    album = \"\";\n    msg.album = album;\n} \n    context.set(\"albumsave\", album);\n    msg.album = album;\n  } else {\n    msg.erreur_album = \"album est Undefined\";\n    var album = \"\";\n    context.set(\"albumsave\", album);\n    msg.album = album;\n  }\n\n  // Label\n  if (typeof playing_item.label !== 'undefined' && playing_item.label !== null) {\n    msg.erreur_label = \"label OK\";\n    var label = \"Label: \" + playing_item.label.toUpperCase();\n    context.set(\"labelsave\", label);\n    msg.label = label;\n    \n  } else {\n    msg.erreur_label = \"label est Undefined\";\n    var label = \"\";\n    context.set(\"labelsave\", label);\n     msg.label = label;\n  }\n  \n} else {\n  msg.cover = context.get(\"coversave\");\n  msg.artist = context.get(\"artistsave\");\n  msg.title = context.get(\"titlesave\");\n  msg.album = context.get(\"albumsave\");\n  msg.label = context.get(\"labelsave\");\n}\n// Formatage des Meta Liked: Timestamp(0) + Date de diffusion(1) + Heure de diffusion(2) + Duree(2) + Chaine(3) + Radio(4) + Artist(5) + Titre(6) + Album(7) + Label(8) + Cover(9)\nvar timestamp = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(start).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(start).format('HH[h]mm'); \nvar now_playing= msg.duree +\"|\"+ msg.chaine +\"|\"+msg.radio +\"|\"+msg.artist+\"|\"+msg.title+\"|\"+msg.album+\"|\"+msg.label +\"|\"+ msg.cover;\nmsg.now_playing_liked = timestamp +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ now_playing;\n\n// Formatage des Meta IceCast: Artiste - Titre (/ Album) \nmsg.title_ice = msg.title;\n//Si titre et album ne sont pas vides on ajoute le separateur / pour delimiter l'album\nif ((msg.title !== \"\") && (msg.album!== \"\")) {msg.title_ice = msg.title + \" / \"}\nmsg.url = \"http://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\" + msg.iceradio + \"&mode=updinfo&song=\" + encodeURIComponent (msg.artist) + \"%20-%20\" + encodeURIComponent (msg.title_ice) + encodeURIComponent (msg.album);\n\n// Formatage des Meta logs: Duree + Chaine + Radio + Artist + Titre + Album + Label + Cover (Time stamp et date et heure de diffusion ajoutés ensuite aprés le RBE)\nmsg.now_playing=now_playing;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":320,"wires":[["bb5949a7.d1c198","e87e10f2.e7d41"]]},{"id":"bb5949a7.d1c198","type":"ui_template","z":"2bb9e260.b0adde","group":"f63c93cf.832d6","name":"100% Mix","order":2,"width":6,"height":"11","format":"<!--\n================================\nMix\n================================\n\nAudio HTML5 Control\n-->\n<div>\n     <audio preload=\"none\" id=\"audio_mix\"></audio>\n</div>\n\n<!-- Banniére Radio -->\n<div class=\"banner-cmd\">\n  <div class=\"banner-cmd-start\">\n    <button id=\"pButton_mix\" class=\"fas fa-headphones-alt fa-2x\" onclick=\"playmix()\"></button>\n  </div>\n  \n  <div class=\"banner-cmd-middle\"><span class=\"radio\">{{msg.radio}}</span></div>\n  \n  <div class=\"banner-cmd-end\">\n      <button id=\"pRoonwhite_fip\" class=\"playroonwhite\" ng-click=\"send({topic: 'roon', payload: msg.roonradio})\"></button>\n  </div>\n</div>\n\n<!-- Durées -->\n<div>\n<p class=\"diffusion\">{{msg.start}} > {{msg.end}} ({{msg.duree}})</p>\n</div>\n\n<!-- Cover -->\n<div align=\"center\">\n  <img class=\"pochette\" src=\"{{msg.cover}}\">\n </div>\n\n\n<!-- Metadata -->\n <h2 class=\"artiste\">{{msg.artist}}</h2>\n <a href=\"#\" ng-click=\"send({topic: 'liked', payload: msg.now_playing_liked})\">\n <span class=\"fa fa-star\" aria-hidden=\"true\"></span>   {{msg.title}}\n</a>\n <h3 class=\"album\">{{msg.album}}</h3>\n <h3 class=\"label\">{{msg.label}}</h3>\n","storeOutMessages":false,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","x":850,"y":320,"wires":[["5e376b1f.ec77d4"]]},{"id":"cf0e3808.082498","type":"function","z":"2bb9e260.b0adde","d":true,"name":"To Logs","func":"//var timestamp = new Date().toISOString();\n//payload = timestamp +\"|\"+ msg.now_playing;\n// Méthode pour capitaliser le premier caractère de la chaine.\nString.prototype.capitalizeinitial = String.prototype.capitalizeinitial || function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n}\nvar moment = global.get('moment');\nvar diffusion = new Date().toISOString();\nmoment.locale('fr');\nvar date_diffusion= moment(diffusion).format('dddd Do MMMM YYYY');\ndate_diffusion = date_diffusion.capitalizeinitial();\nvar heure_diffusion= moment(diffusion).format('HH[h]mm'); \nmsg.payload = diffusion +\"|\"+ date_diffusion +\"|\"+ heure_diffusion +\"|\"+ msg.now_playing;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1220,"y":620,"wires":[["d95b33b2.1d158"]],"info":"**Pour éviter de transmettre un payload** de metadata sur MQQT out dés qu'il y a de nouvelles meta qui se retrouvent dans les logs de l'extension (sans que cela soit bloquant) on pourrait utiliser plus proprement ce node pour faire un routage en lui adjoignant 2 sorties et un test de chaque message en fonction de son topic:\n\n- Si le topic est roon/HQPlayer/browse/internet_radio c'est une commande de lancement de radio et on transmet le message en output 1 au node MQTT.\n\n- Sinon, on fait la concatenation pour les logs et on transmet en output 2 vers le module d'export.\n\nVoir: [https://nodered.org/docs/user-guide/writing-functions]()\n\n> if (msg.payload === \"topicMQTT\") {\n>    return [ msg, null ];\n> } else {\n>    return [ null, msg ];\n> }"},{"id":"d95b33b2.1d158","type":"file","z":"2bb9e260.b0adde","name":"Export Fichier Log","filename":"/home/bruno/mouv.log","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"utf8","x":1430,"y":620,"wires":[[]]},{"id":"11ed6839.31fa08","type":"rbe","z":"2bb9e260.b0adde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":830,"y":380,"wires":[["aa96240e.a56668","cf0e3808.082498"]]},{"id":"d85c63cd.211be","type":"function","z":"2bb9e260.b0adde","name":"Classics","func":"// MOUV CLASSICS\nmsg.chaine = \"Le Mouv\";\nmsg.radio = \"Classics\";\nmsg.iceradio = \"mouvclassics\";\nmsg.roonradio = \"Le Mouv Classics\";\nreturn msg;\n/* \nURL serveur Ice Cast:\nhttp://admin:bruno@192.168.0.176:8000/admin/metadata?mount=/\n\nURL audio dans mouv.js pour écoute hors ROON\nurl_classics = \"https://icecast.radiofrance.fr/mouvclassics-hifi.aac\";\nurl_dancehall = \"https://icecast.radiofrance.fr/mouvdancehall-hifi.aac\";\nurl_rnb = \"https://icecast.radiofrance.fr/mouvrnb-hifi.aac\";\nurl_rapus = \"https://icecast.radiofrance.fr/mouvrapus-hifi.aac\";\nurl_rapfr = \"https://icecast.radiofrance.fr/mouvrapfr-hifi.aac\";\nurl_kids = \"https://icecast.radiofrance.fr/mouvkidsnfamily-hifi.aac\";\nurl_mix = \"https://icecast.radiofrance.fr/mouv100p100mix-hifi.aac\";\n*/","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":80,"wires":[["2693a84d.d4ecd8"]]},{"id":"a1912acf.39e878","type":"function","z":"2bb9e260.b0adde","name":"Dance","func":"// MOUV DANCE\nmsg.chaine = \"Le Mouv\";\nmsg.radio = \"DanceHall\";\nmsg.iceradio = \"mouvdancehall\";\nmsg.roonradio = \"Le Mouv DanceHall\";\nreturn msg;\n////////////////////////////////////////////////////////////////\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":120,"wires":[["593a8a1b.ad3a84"]]},{"id":"f032bd29.2b59b","type":"rbe","z":"2bb9e260.b0adde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":830,"y":420,"wires":[["cf0e3808.082498","aa96240e.a56668"]]},{"id":"9de28919.6695a8","type":"rbe","z":"2bb9e260.b0adde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":830,"y":460,"wires":[["aa96240e.a56668","cf0e3808.082498"]]},{"id":"b87c6a5f.bf1198","type":"function","z":"2bb9e260.b0adde","name":"RNB","func":"// MOUV RNB\nmsg.chaine = \"Le Mouv\";\nmsg.radio = \"RbB & Soul\";\nmsg.iceradio = \"mouvrnb\";\nmsg.roonradio = \"Le Mouv RnB & Soul\";\nreturn msg;\n////////////////////////////////////////////////////////////////\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":160,"wires":[["cc44d340.f9b07"]]},{"id":"e40edaf4.f7ec38","type":"function","z":"2bb9e260.b0adde","name":"RapUS","func":"// MOUV RAP US\nmsg.chaine = \"Le Mouv\";\nmsg.radio = \"Rap US\";\nmsg.iceradio = \"mouvrapus\";\nmsg.roonradio = \"Le Mouv Rap US\";\nreturn msg;\n////////////////////////////////////////////////////////////////\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":200,"wires":[["fa384da.befdeb"]]},{"id":"9f365586.ea5ff8","type":"function","z":"2bb9e260.b0adde","name":"RapFR","func":"// MOUV RAP FR\nmsg.chaine = \"Le Mouv\";\nmsg.radio = \"Rap Français\";\nmsg.iceradio = \"mouvrapfr\";\nmsg.roonradio = \"Le Mouv Rap FR\";\nreturn msg;\n////////////////////////////////////////////////////////////////\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":240,"wires":[["5b608419.3e4d2c"]]},{"id":"2fd87caa.91c444","type":"function","z":"2bb9e260.b0adde","name":"Kids","func":"// MOUV KIDS\nmsg.chaine = \"Le Mouv\";\nmsg.radio = \"Kids 'N Family\";\nmsg.iceradio = \"mouvkidsnfamily\";\nmsg.roonradio = \"Le Mouv Kids\";\nreturn msg;\n////////////////////////////////////////////////////////////////\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":280,"wires":[["2dd8d175.48b22e"]]},{"id":"5d1af6b.79eac08","type":"function","z":"2bb9e260.b0adde","name":"Mix","func":"// MOUV MIX\nmsg.chaine = \"Le Mouv\";\nmsg.radio = \"100% Mix\";\nmsg.iceradio = \"mouv100p100mix\";\nmsg.roonradio = \"Le Mouv 100% Mix\";\nreturn msg;\n////////////////////////////////////////////////////////////////\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":320,"wires":[["9a66feff.c8c5c"]]},{"id":"8ff09507.5f99d8","type":"rbe","z":"2bb9e260.b0adde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":830,"y":500,"wires":[["aa96240e.a56668","cf0e3808.082498"]]},{"id":"afc86f5e.fb867","type":"rbe","z":"2bb9e260.b0adde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":830,"y":540,"wires":[["aa96240e.a56668","cf0e3808.082498"]]},{"id":"3ede1e3e.8f0a82","type":"rbe","z":"2bb9e260.b0adde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":830,"y":580,"wires":[["cf0e3808.082498","aa96240e.a56668"]]},{"id":"e87e10f2.e7d41","type":"rbe","z":"2bb9e260.b0adde","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"now_playing","x":830,"y":620,"wires":[["cf0e3808.082498","aa96240e.a56668"]]},{"id":"5e376b1f.ec77d4","type":"subflow:56eea0e0.0ebaa","z":"2bb9e260.b0adde","name":"","x":1160,"y":200,"wires":[]},{"id":"ccd03b13.3fd048","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.song.__typename","propertyType":"msg","rules":[{"t":"eq","v":"SongOnAir","vt":"str"},{"t":"eq","v":"TimelineItem","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1771,"y":325.00001525878906,"wires":[["ddb01da4.3187e"],[]]},{"id":"396536dd.672efa","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.mode","propertyType":"msg","rules":[{"t":"eq","v":"song","vt":"str"},{"t":"eq","v":"program","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1771,"y":285.00001525878906,"wires":[["ddb01da4.3187e"],["db51c629.3d63e"],[]]},{"id":"7c54a979.152b98","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.song.__typename","propertyType":"msg","rules":[{"t":"eq","v":"SongOnAir","vt":"str"},{"t":"eq","v":"TimelineItem","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1771,"y":365.00001525878906,"wires":[["ddb01da4.3187e"],[]]},{"id":"cb31136a.4318c8","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.song.__typename","propertyType":"msg","rules":[{"t":"eq","v":"SongOnAir","vt":"str"},{"t":"eq","v":"TimelineItem","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1771,"y":405.00001525878906,"wires":[["ddb01da4.3187e"],[]]},{"id":"9a33a010.3b841","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.song.__typename","propertyType":"msg","rules":[{"t":"eq","v":"SongOnAir","vt":"str"},{"t":"eq","v":"TimelineItem","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1771,"y":445.00001525878906,"wires":[["ddb01da4.3187e"],[]]},{"id":"c0f31f6a.a7bb08","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.song.__typename","propertyType":"msg","rules":[{"t":"eq","v":"SongOnAir","vt":"str"},{"t":"eq","v":"TimelineItem","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1771,"y":485.00001525878906,"wires":[["ddb01da4.3187e"],[]]},{"id":"254577da.ba85c8","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.song.__typename","propertyType":"msg","rules":[{"t":"eq","v":"SongOnAir","vt":"str"},{"t":"eq","v":"TimelineItem","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1771,"y":525.0000152587891,"wires":[["ddb01da4.3187e"],[]]},{"id":"ed028c2f.1f393","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.song.__typename","propertyType":"msg","rules":[{"t":"eq","v":"SongOnAir","vt":"str"},{"t":"eq","v":"TimelineItem","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1771,"y":565.0000152587891,"wires":[["ddb01da4.3187e"],[]]},{"id":"35d8c6f4.043bda","type":"inject","z":"40eacea7.33a8e8","name":"FIP","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A7%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"radio","v":"fip","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":990,"y":280,"wires":[["c91b19f5.cd3898"]]},{"id":"c91b19f5.cd3898","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1330,"y":280,"wires":[["fac0ed61.668be8"]]},{"id":"5d5efc29.760cac","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":280,"wires":[["396536dd.672efa"]]},{"id":"bf7b6136.bdf47","type":"inject","z":"40eacea7.33a8e8","name":"FIP Rock","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A64%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"},{"p":"radio","v":"fiprock","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.2","topic":"","x":1000,"y":320,"wires":[["c133531f.e2873"]]},{"id":"c133531f.e2873","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"authType":"","x":1330,"y":320,"wires":[["a61da39a.cbeeb"]]},{"id":"6bfecc7e.5c26f4","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":320,"wires":[["ccd03b13.3fd048"]]},{"id":"5c571d44.7ed3c4","type":"inject","z":"40eacea7.33a8e8","name":"FIP Jazz","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A65%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"radio","v":"fipjazz","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.3","topic":"","x":1000,"y":360,"wires":[["5d43bbb.c319744"]]},{"id":"5d43bbb.c319744","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"authType":"","x":1330,"y":360,"wires":[["da3454fa.b6fb88"]]},{"id":"eecc39e5.2e94a8","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":360,"wires":[["7c54a979.152b98"]]},{"id":"8a17315.958f2d","type":"inject","z":"40eacea7.33a8e8","name":"FIP Groove","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A66%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"radio","v":"fipgroove","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.4","topic":"","x":1010,"y":400,"wires":[["36aabac.505c3c6"]]},{"id":"36aabac.505c3c6","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"authType":"","x":1330,"y":400,"wires":[["61890408.0770cc"]]},{"id":"80893345.bb4ac8","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":400,"wires":[["cb31136a.4318c8"]]},{"id":"b1e9bda7.b86858","type":"inject","z":"40eacea7.33a8e8","name":"FIP Monde","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A69%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"radio","v":"fipmonde","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.4","topic":"","x":1010,"y":440,"wires":[["2b92606e.c7c47"]]},{"id":"2b92606e.c7c47","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1330,"y":440,"wires":[["b172983.0d019e8"]]},{"id":"4fdd44f6.a9092c","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":440,"wires":[["9a33a010.3b841"]]},{"id":"38583df6.b030e2","type":"inject","z":"40eacea7.33a8e8","name":"FIP Nouveauté","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A70%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"radio","v":"fipnouveaute","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.5","topic":"","x":1020,"y":480,"wires":[["72f0517e.829fc"]]},{"id":"72f0517e.829fc","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1330,"y":480,"wires":[["9daa3133.12231"]]},{"id":"315d2e77.bd657a","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":480,"wires":[["c0f31f6a.a7bb08"]]},{"id":"4b0f1f96.33f458","type":"inject","z":"40eacea7.33a8e8","name":"FIP Reggae","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A71%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"radio","v":"fipreggae","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.6","topic":"","x":1010,"y":520,"wires":[["5d5ed838.629438"]]},{"id":"5d5ed838.629438","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"authType":"","x":1330,"y":520,"wires":[["63b94ac9.6c0e4c"]]},{"id":"c0f001eb.c7b658","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":520,"wires":[["254577da.ba85c8"]]},{"id":"c7d53718.393e3","type":"inject","z":"40eacea7.33a8e8","name":"FIP Electro","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A74%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"radio","v":"fipelectro","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.7","topic":"","x":1010,"y":560,"wires":[["76fa9a92.3fbf1c"]]},{"id":"76fa9a92.3fbf1c","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"authType":"","x":1330,"y":560,"wires":[["2f0ffe79.e671ea"]]},{"id":"1b9ac99c.c42576","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":560,"wires":[["ed028c2f.1f393"]]},{"id":"eb669c10.fc4728","type":"function","z":"40eacea7.33a8e8","name":"fm labaroque","func":"\nmsg.radio = \"francemusiquelabaroque\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":800,"wires":[["658d71fe.88e1e"]]},{"id":"945d31c0.615b18","type":"inject","z":"40eacea7.33a8e8","name":"France Musique La Baroque","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A408%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.1","topic":"","x":1060,"y":800,"wires":[["9f817ee3.23431"]]},{"id":"9f817ee3.23431","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":800,"wires":[["e31553.0e6672b"]]},{"id":"e31553.0e6672b","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":800,"wires":[["eb669c10.fc4728"]]},{"id":"e759e300.202798","type":"function","z":"40eacea7.33a8e8","name":"fm classiqueeasy","func":"\nmsg.radio = \"francemusiqueclassiqueeasy\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":840,"wires":[["658d71fe.88e1e"]]},{"id":"b7dd6d1f.3ca5b8","type":"inject","z":"40eacea7.33a8e8","name":"France Musique Classique Easy","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A401%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.2","topic":"","x":1080,"y":840,"wires":[["5154b89c.65f9"]]},{"id":"5154b89c.65f9","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":840,"wires":[["db752a.4e813ad8"]]},{"id":"db752a.4e813ad8","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":840,"wires":[["e759e300.202798"]]},{"id":"fc7c96cd.05003","type":"function","z":"40eacea7.33a8e8","name":"fm classiqueeasyplus","func":"\nmsg.radio = \"francemusiqueclassiqueplus\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":880,"wires":[["658d71fe.88e1e"]]},{"id":"9793e854.7a691","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":880,"wires":[["fc7c96cd.05003"]]},{"id":"1191c527.105513","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":880,"wires":[["9793e854.7a691"]]},{"id":"d53e1a0d.11d2b8","type":"inject","z":"40eacea7.33a8e8","name":"France Musique Classique Plus","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A402%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.3","topic":"","x":1070,"y":880,"wires":[["1191c527.105513"]]},{"id":"bda59df8.51aed8","type":"function","z":"40eacea7.33a8e8","name":"fm concerts Song ","func":"\nmsg.radio = \"francemusiqueconcertsradiofrance\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":720,"wires":[["1a5bfa39.580766"]]},{"id":"f71585bd.c04368","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":760,"wires":[["41f2e234.248734"]]},{"id":"3569c152.7edf9e","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":760,"wires":[["f71585bd.c04368"]]},{"id":"609a5976.26a33","type":"inject","z":"40eacea7.33a8e8","name":"France Musique Concerts Radio France","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A403%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1","topic":"","x":1100,"y":760,"wires":[["3569c152.7edf9e"]]},{"id":"c4002bde.1918d","type":"function","z":"40eacea7.33a8e8","name":"fm lajazz","func":"\nmsg.radio = \"francemusiquelajazz\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1940,"y":920,"wires":[["658d71fe.88e1e"]]},{"id":"2924101a.5ee9e","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":920,"wires":[["c4002bde.1918d"]]},{"id":"d5c2d9af.e84fa8","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":920,"wires":[["2924101a.5ee9e"]]},{"id":"d9df1f9f.e97888","type":"inject","z":"40eacea7.33a8e8","name":"France Musique La Jazz","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A405%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.4","topic":"","x":1053,"y":914.0000152587891,"wires":[["d5c2d9af.e84fa8"]]},{"id":"462307b0.11b2d8","type":"function","z":"40eacea7.33a8e8","name":"fm lacontemporaine","func":"\nmsg.radio = \"francemusiquelacontemporaine\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":960,"wires":[["658d71fe.88e1e"]]},{"id":"1e6a9224.40dfe6","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":960,"wires":[["462307b0.11b2d8"]]},{"id":"227e80e1.e3ea28","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":960,"wires":[["1e6a9224.40dfe6"]]},{"id":"f32822b7.92c698","type":"inject","z":"40eacea7.33a8e8","name":"France Musique La Contemporaine","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A406%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.5","topic":"","x":1090,"y":960,"wires":[["227e80e1.e3ea28"]]},{"id":"428f4229.1c7a04","type":"function","z":"40eacea7.33a8e8","name":"fm ocora","func":"\nmsg.radio = \"francemusiqueocora\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1940,"y":1000,"wires":[["658d71fe.88e1e"]]},{"id":"2d195ce8.b2bcc4","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":1000,"wires":[["428f4229.1c7a04"]]},{"id":"a9af9c3e.7852d","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":1000,"wires":[["2d195ce8.b2bcc4"]]},{"id":"e020b34d.e9eee","type":"inject","z":"40eacea7.33a8e8","name":"France Musique Ocora","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A404%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.6","topic":"","x":1050,"y":1000,"wires":[["a9af9c3e.7852d"]]},{"id":"ac5f43af.d0fcc8","type":"function","z":"40eacea7.33a8e8","name":"fm labo","func":"\nmsg.radio = \"francemusiquelabo\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1940,"y":1040,"wires":[["658d71fe.88e1e"]]},{"id":"d1a4eb76.d198c","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":1040,"wires":[["ac5f43af.d0fcc8"]]},{"id":"3e698a10.9942ee","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":1040,"wires":[["d1a4eb76.d198c"]]},{"id":"bc47377d.4fa8b","type":"inject","z":"40eacea7.33a8e8","name":"France Musique la BO","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A407%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.7","topic":"","x":1053,"y":1034.000015258789,"wires":[["3e698a10.9942ee"]]},{"id":"66ff2ed8.093f1","type":"inject","z":"40eacea7.33a8e8","name":"France Musique","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A4%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.9","topic":"","x":1030,"y":720,"wires":[["ea8c98e0.29f978"]]},{"id":"ea8c98e0.29f978","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":720,"wires":[["f224bb6e.eb5b78"]]},{"id":"f224bb6e.eb5b78","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":720,"wires":[["d04e4f07.c89708"]]},{"id":"7ab3eac2.4e6d9c","type":"function","z":"40eacea7.33a8e8","name":"fm Song ","func":"\nmsg.radio = \"francemusique\";\nmsg.sendtoicecast = true;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1940,"y":640,"wires":[["1a5bfa39.580766"]]},{"id":"d04e4f07.c89708","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.mode","propertyType":"msg","rules":[{"t":"eq","v":"song","vt":"str"},{"t":"eq","v":"program","vt":"str"},{"t":"else"}],"checkall":"false","repair":true,"outputs":3,"x":1790,"y":680,"wires":[["7ab3eac2.4e6d9c"],["88d3d4aa.a2877"],["b7c71385.0a1288"]]},{"id":"88d3d4aa.a2877","type":"function","z":"40eacea7.33a8e8","name":"fm Program ","func":"\nvar programname=\"\";\nvar animator=\"\";\n\n\nif (msg.payload.data.now.program != null)\n{\n    programname = msg.payload.data.now.program.name;\n    animator = msg.payload.data.now.program.animators;\n\nif (animator == null) animator = \"\";\nif (animator !=\"\") programname = programname + \" - \";\n\n}\nmsg.payload = programname + animator ;\nif (msg.payload ==\"\") msg.payload = \"no data sent by Radio France\";\n\nmsg.radio = \"francemusique\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":680,"wires":[["8817da4b.0bc578"]]},{"id":"23a9aa18.9430a6","type":"inject","z":"40eacea7.33a8e8","name":"France Inter","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A1%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"},{"p":"radio","v":"franceinter","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.9","topic":"","x":1012,"y":1120,"wires":[["7e02de90.595bf8"]]},{"id":"7e02de90.595bf8","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":1120,"wires":[["3a8ad8ec.34bdd8"]]},{"id":"5e6d3184.14c8b","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":1120,"wires":[["dea92db8.540268"]]},{"id":"dea92db8.540268","type":"function","z":"40eacea7.33a8e8","name":"franceinter","func":"\nvar programname = \"\";\nvar animator = \"\";\n\nif (msg.payload.data.now.program !=null)\n{\n    programname =msg.payload.data.now.program.name;\n    animator = msg.payload.data.now.program.animators\n\nif (programname == null) programname = \"\";\nif (animator == null) animator = \"\";\n}\n\nif (animator !=\"\") programname = programname + \" - \";\n\nmsg.payload = programname + animator ;\nif (msg.payload ==\"\") msg.payload = \"no data sent by Radio France :(\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1942,"y":1122.0000019073486,"wires":[["8817da4b.0bc578"]]},{"id":"41f2e234.248734","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.mode","propertyType":"msg","rules":[{"t":"eq","v":"song","vt":"str"},{"t":"eq","v":"program","vt":"str"},{"t":"else"}],"checkall":"false","repair":true,"outputs":3,"x":1790,"y":760,"wires":[["bda59df8.51aed8"],["6e931f6.bbeb2e"],["b7c71385.0a1288"]]},{"id":"6e931f6.bbeb2e","type":"function","z":"40eacea7.33a8e8","name":"fm concerts Program","func":"\nvar programname = msg.payload.data.now.program;\nvar animator = msg.payload.data.now.animators;\n\nif (programname == null) programname = \"\";\nif (animator == null) animator = \"\";\nif (animator !=\"\") programname = programname + \" avec \";\n\nmsg.payload = programname + animator ;\nif (msg.payload ==\"\") msg.payload = \"No data sent by Radio France :(\";\n\nmsg.radio = \"francemusiqueconcertsradiofrance\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":760,"wires":[["8817da4b.0bc578"]]},{"id":"db51c629.3d63e","type":"function","z":"40eacea7.33a8e8","name":"fip Program","func":"var programname;\nvar animator;\n\nif (msg.payload.data.now.program != null)\n{\nprogramname = msg.payload.data.now.program.name;\nanimator = msg.payload.data.now.program.animators;\nif (animator == null) animator = \"\";\nif (animator !=\"\") programname = programname + \" - \";\nmsg.payload = programname + animator ;\n}\nelse\n{\n    msg.payload = \"no data sent by Radio France\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2190,"y":460,"wires":[["8817da4b.0bc578"]]},{"id":"16cab8da.244e57","type":"function","z":"40eacea7.33a8e8","name":"BBC processing","func":"\nvar playing_item = msg.payload.data[0];\n\nif (playing_item.offset.now_playing == true)\n{\nvar artist = playing_item.titles.primary;\nvar title = playing_item.titles.secondary;\nvar album = playing_item.titles.tertiary;\n\nif (artist == null) artist = \"\";\nif (title == null) title = \"\";\nif (album == null) album = \"\";\n\nmsg.artist = artist;\nmsg.title = title;\n\nmsg.album = album ; \nif (album != \"\") title = title + \" / \";\nmsg.payload = artist + \" - \" + title + album;\nmsg.mode = \"song\";\n}\nelse\n{ \n    msg.payload = msg.radioname;\n    msg.mode = \"program\"\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2200,"y":1180,"wires":[["5ee7469e.d59338"]]},{"id":"24848a6e.180e6e","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1570.9999732971191,"y":1342.0000019073486,"wires":[["c6faba77.40ebd8"]]},{"id":"8d530f4d.39c498","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":1340,"wires":[["e70f0408.e01ea"]]},{"id":"323476c8.d11462","type":"inject","z":"40eacea7.33a8e8","name":"BBC Radio 6 Music","props":[{"p":"url","v":"https://rms.api.bbc.co.uk/v2/services/bbc_6music/segments/latest","vt":"str"},{"p":"radio","v":"bbcradio6","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.3","topic":"","x":1040,"y":1340,"wires":[["8d530f4d.39c498"]]},{"id":"c58fb6f.d1274c8","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1839.9999771118164,"y":1340.0000019073486,"wires":[["16cab8da.244e57"],["f20b9b54.3a8008"]]},{"id":"c6faba77.40ebd8","type":"function","z":"40eacea7.33a8e8","name":"bbcradio6","func":"msg.radioname = \"BBC Radio 6\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1707.9999771118164,"y":1341.0000019073486,"wires":[["c58fb6f.d1274c8"]]},{"id":"3ab84015.1920a8","type":"inject","z":"40eacea7.33a8e8","name":"France Musique Opéra","props":[{"p":"url","v":"https://www.francemusique.fr/latest/api/graphql?operationName=Now&variables=%7B%22first%22%3A1%2C%22after%22%3A%22%22%2C%22stationId%22%3A409%2C%22preset%22%3A%22300-noTransform%22%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%2282e80bcce496144769d98be689f3350d60f4a29289f320517dbc5d07e96a8b06%22%7D%7D","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"1.8","topic":"","x":1053,"y":1074.000015258789,"wires":[["82635fca.8e1388"]]},{"id":"82635fca.8e1388","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1350,"y":1080,"wires":[["418f0202.eaf43c"]]},{"id":"418f0202.eaf43c","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1670,"y":1080,"wires":[["6326b117.2e6fa8"]]},{"id":"6326b117.2e6fa8","type":"function","z":"40eacea7.33a8e8","name":"fm opera","func":"\nmsg.radio = \"francemusiqueopera\";\nmsg.sendtoicecast = true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1940,"y":1080,"wires":[["658d71fe.88e1e"]]},{"id":"2306b7c8.83c04","type":"inject","z":"40eacea7.33a8e8","name":"FIP Pop","props":[{"p":"url","v":"https://www.fip.fr/latest/api/graphql?operationName=Now&variables=%7B%22bannerPreset%22%3A%22600x600-noTransform%22%2C%22stationId%22%3A78%2C%22previousTrackLimit%22%3A3%7D&extensions=%7B%22persistedQuery%22%3A%7B%22version%22%3A1%2C%22sha256Hash%22%3A%228a931c7d177ff69709a79f4c213bd2403f0c11836c560bc22da55628d8100df8%22%7D%7D","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"},{"p":"radio","v":"fippop","vt":"str"}],"repeat":"9","crontab":"","once":true,"onceDelay":"0.8","topic":"","x":1000,"y":600,"wires":[["723c7f26.fc0eb8"]]},{"id":"723c7f26.fc0eb8","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":false,"url":"","persist":false,"authType":"","x":1330,"y":600,"wires":[["dc336e8.852891"]]},{"id":"2b6e5ecd.005b42","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1650,"y":600,"wires":[["daa0d0c9.2bffc"]]},{"id":"daa0d0c9.2bffc","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data.now.song.__typename","propertyType":"msg","rules":[{"t":"eq","v":"SongOnAir","vt":"str"},{"t":"eq","v":"TimelineItem","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1771,"y":614.0000152587891,"wires":[["ddb01da4.3187e"],[]]},{"id":"fb1219e4.eb0f6","type":"inject","z":"40eacea7.33a8e8","name":"Amazing Radio UK","props":[{"p":"url","v":"https://api.amazingtunes.com/radio/uk/airplays?page%5Bsize%5D=7&include%5B%5D=tune&include%5B%5D=tune.artist&skip_loading=true&ngsw-bypass=true","vt":"str"},{"p":"radio","v":"amazingradiouk","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.5","topic":"","x":1040,"y":1560,"wires":[["53ac8616.718f68"]]},{"id":"53ac8616.718f68","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":1560,"wires":[["a377a9ad.3059f"]]},{"id":"23ee132a.c57e5c","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1590,"y":1560,"wires":[["e42a8ff8.7794a"]]},{"id":"e42a8ff8.7794a","type":"function","z":"40eacea7.33a8e8","name":"amazingradiouk processing","func":"\nvar playing_item = msg.payload.data[0].attributes.description;\n\nmsg.payload = playing_item;\n\nmsg.radio = \"amazingradiouk\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2000,"y":1560,"wires":[["820cb2d9.639cf"]]},{"id":"15da092c.c6dbbf","type":"inject","z":"40eacea7.33a8e8","name":"Amazing Radio US","props":[{"p":"url","v":"https://api.amazingtunes.com/radio/us/airplays?page%5Bsize%5D=7&include%5B%5D=tune&include%5B%5D=tune.artist&skip_loading=true&ngsw-bypass=true","vt":"str"},{"p":"radio","v":"amazingradious","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.6","topic":"","x":1040,"y":1600,"wires":[["3cd8ced5.cec182"]]},{"id":"3cd8ced5.cec182","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":1600,"wires":[["cbdb743e.ffb45"]]},{"id":"b817f998.d41dd","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1590,"y":1600,"wires":[["8ec43c1e.64d668"]]},{"id":"8ec43c1e.64d668","type":"function","z":"40eacea7.33a8e8","name":"amazingradious processing","func":"\nvar playing_item = msg.payload.data[0].attributes.description;\n\nmsg.payload = playing_item;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2000,"y":1600,"wires":[["820cb2d9.639cf"]]},{"id":"f448af8f.7545c","type":"http request","z":"40eacea7.33a8e8","name":"Send 2 Icecast_Server","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":3560,"y":580,"wires":[[]]},{"id":"521f6d0f.68cd04","type":"inject","z":"40eacea7.33a8e8","name":"Classic 21","props":[{"p":"url","v":"https://np.maradio.be/qp/v3/onair?callback=jQuery31109888789096607657_1614532259536&rpIds=2&nameSize=100000&serviceNameSize=100000&artistNameSize=100000&descriptionSize=100000&_=1614532259549","vt":"str"},{"p":"radio","v":"classic21","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.4","topic":"","payloadType":"str","x":1010,"y":1500,"wires":[["aaa48050.6147b"]]},{"id":"aaa48050.6147b","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":1500,"wires":[["f92968fc.65c1c"]]},{"id":"fb11e254.2e9298","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1630,"y":1500,"wires":[["16b3244b.0e6384"]]},{"id":"16b3244b.0e6384","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.responseStatus","propertyType":"msg","rules":[{"t":"eq","v":"SUCCESS","vt":"str"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1750,"y":1500,"wires":[["d21f9a45.c11ea8"],[]]},{"id":"d4d0970d.ef8e9","type":"function","z":"40eacea7.33a8e8","name":"rtbf","func":"\nvar playing_item = msg.payload;\nvar n = 0;\nvar title =\"\";\nvar artists =\"\";\n\nwhile ((playing_item[n].song==false) && (n < (playing_item.length)-1))\n{    n = n+1;\n}\nif (playing_item[n].song== false)\n{\n     title = playing_item[0].name;\n     artist = \"\";\n}\nelse\n{\n title = playing_item[n].name;\n artist = playing_item[n].artistName; \n}\n\nmsg.artist = artist;\nif (artist !=\"\") artist = artist +\" - \";\nmsg.title = title;\nmsg.payload = artist + title ;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2050,"y":1500,"wires":[["820cb2d9.639cf"]]},{"id":"29442b66.2f7ac4","type":"function","z":"40eacea7.33a8e8","name":"slice resp.","func":"var chaine = msg.payload;\n\nif (msg.payload != undefined) \n      msg.payload = chaine.slice(41,-1);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1500,"y":1500,"wires":[["fb11e254.2e9298"]]},{"id":"d21f9a45.c11ea8","type":"change","z":"40eacea7.33a8e8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.results.2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1900,"y":1500,"wires":[["d4d0970d.ef8e9"]]},{"id":"78c517ea.6d43d8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fip","method":"get","upload":false,"swaggerDoc":"","x":600,"y":280,"wires":[["90e1669e.c73408"]]},{"id":"90e1669e.c73408","type":"function","z":"40eacea7.33a8e8","name":"Retrieve metadata from Environment variables","func":"msg.payload = JSON.stringify(global.get(msg.req.url.slice(1,9999999)));\nmsg.ip = msg.req.ip;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":200,"wires":[["77640728.986a48"]]},{"id":"7382f737.da61e8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/bbcradio6","method":"get","upload":false,"swaggerDoc":"","x":620,"y":1340,"wires":[["90e1669e.c73408"]]},{"id":"77640728.986a48","type":"change","z":"40eacea7.33a8e8","name":"Set Headers","rules":[{"t":"set","p":"headers","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"headers.content-type","pt":"msg","to":"application/json","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1650,"y":160,"wires":[["8bf61ce9.7e7dd"]]},{"id":"20c7e111.0d4bbe","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/classic21","method":"get","upload":false,"swaggerDoc":"","x":620,"y":1500,"wires":[["90e1669e.c73408"]]},{"id":"8bf61ce9.7e7dd","type":"http response","z":"40eacea7.33a8e8","name":"Send JSON","statusCode":"","headers":{},"x":1850,"y":160,"wires":[]},{"id":"52eec23.234533c","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fiprock","method":"get","upload":false,"swaggerDoc":"","x":610,"y":320,"wires":[["90e1669e.c73408"]]},{"id":"13e62a1d.0cc1d6","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fipjazz","method":"get","upload":false,"swaggerDoc":"","x":610,"y":360,"wires":[["90e1669e.c73408"]]},{"id":"ed510bdb.75bf18","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fipgroove","method":"get","upload":false,"swaggerDoc":"","x":620,"y":400,"wires":[["90e1669e.c73408"]]},{"id":"bb30c4c5.f6a8a8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fipmonde","method":"get","upload":false,"swaggerDoc":"","x":620,"y":440,"wires":[["90e1669e.c73408"]]},{"id":"f5d06c72.42d76","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fipnouveaute","method":"get","upload":false,"swaggerDoc":"","x":630,"y":480,"wires":[["90e1669e.c73408"]]},{"id":"2fe7ac0f.8147e4","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fipreggae","method":"get","upload":false,"swaggerDoc":"","x":620,"y":520,"wires":[["90e1669e.c73408"]]},{"id":"9ad5944e.25cfa8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fipelectro","method":"get","upload":false,"swaggerDoc":"","x":620,"y":560,"wires":[["90e1669e.c73408"]]},{"id":"9de56fef.7a20e","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/fippop","method":"get","upload":false,"swaggerDoc":"","x":610,"y":600,"wires":[["90e1669e.c73408"]]},{"id":"6235932.981f96c","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusique","method":"get","upload":false,"swaggerDoc":"","x":630,"y":720,"wires":[["90e1669e.c73408"]]},{"id":"ebc7b59f.5c9478","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiquelabaroque","method":"get","upload":false,"swaggerDoc":"","x":670,"y":800,"wires":[["90e1669e.c73408"]]},{"id":"5e7c0d9a.ef13a4","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiqueclassiqueeasy","method":"get","upload":false,"swaggerDoc":"","x":680,"y":840,"wires":[["90e1669e.c73408"]]},{"id":"31553ce4.456da4","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiqueclassiqueplus","method":"get","upload":false,"swaggerDoc":"","x":680,"y":880,"wires":[["90e1669e.c73408"]]},{"id":"23a8a571.53f5aa","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiqueconcertsradiofrance","method":"get","upload":false,"swaggerDoc":"","x":700,"y":760,"wires":[["90e1669e.c73408"]]},{"id":"6cc3bf93.c28d2","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiquelajazz","method":"get","upload":false,"swaggerDoc":"","x":650,"y":920,"wires":[["90e1669e.c73408"]]},{"id":"5173b3c7.3fe44c","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiquelacontemporaine","method":"get","upload":false,"swaggerDoc":"","x":690,"y":960,"wires":[["90e1669e.c73408"]]},{"id":"cf4a44ac.3eca18","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiqueocora","method":"get","upload":false,"swaggerDoc":"","x":650,"y":1000,"wires":[["90e1669e.c73408"]]},{"id":"7ad29079.1077e","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiquelabo","method":"get","upload":false,"swaggerDoc":"","x":650,"y":1040,"wires":[["90e1669e.c73408"]]},{"id":"4ea0a7eb.6d7128","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/francemusiqueopera","method":"get","upload":false,"swaggerDoc":"","x":650,"y":1080,"wires":[["90e1669e.c73408"]]},{"id":"4fecf474.ac4d9c","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/franceinter","method":"get","upload":false,"swaggerDoc":"","x":620,"y":1120,"wires":[["90e1669e.c73408"]]},{"id":"944c5c01.470a8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/amazingradiouk","method":"get","upload":false,"swaggerDoc":"","x":640,"y":1540,"wires":[["90e1669e.c73408"]]},{"id":"fd661391.7e64a","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/amazingradious","method":"get","upload":false,"swaggerDoc":"","x":640,"y":1580,"wires":[["90e1669e.c73408"]]},{"id":"1f6064c7.4e14bb","type":"inject","z":"40eacea7.33a8e8","name":"STREAM HACK (NAIM...)","props":[{"p":"url","v":"http://admin:PASSWORD@radio-metadata.fr:8000/admin/stats.xml","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.7","topic":"","x":1060,"y":1640,"wires":[["9334a79e.e88da8"]]},{"id":"9334a79e.e88da8","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":1640,"wires":[["dec9aac9.c9882"]]},{"id":"367cc798.afbc48","type":"function","z":"40eacea7.33a8e8","name":"Icecast Hack","func":"var n = 0;\nvar src;\nvar metadata;\nvar message={};\n\nmessage.sendtoicecast = msg.sendtoicecast;\n\nwhile (msg.payload.icestats.source[n]!== undefined) \n{\n   src = msg.payload.icestats.source[n];\n   if (src.listenurl[0].includes(\"naimradio\") ==true)\n        {\n            metadata = src.title[0];\n            if ((metadata == null) || (metadata ==\"\")) \n                      metadata = \"No data sent by Naim\";\n            message.payload = metadata;\n            message.radio = \"naimradio\";\n            node.send(message);\n        }\n   if (src.listenurl[0].includes(\"naimjazz\") ==true)\n        {\n            metadata = src.title[0];\n            if ((metadata == null) || (metadata ==\"\")) \n                      metadata = \"No data sent by Naim\";\n            message.payload = metadata;\n            message.radio = \"naimjazz\";\n            node.send(message);\n        }\n   if (src.listenurl[0].includes(\"naimclassical\") ==true)\n        {\n            metadata = src.title[0];\n            if ((metadata == null) || (metadata ==\"\")) \n                      metadata = \"No data sent by Naim\";\n            message.payload = metadata;\n            message.radio = \"naimclassical\";\n            node.send(message);\n        }        \n    n = n+1;\n}\n\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1950,"y":1640,"wires":[["820cb2d9.639cf"]]},{"id":"b7b424d5.62e798","type":"xml","z":"40eacea7.33a8e8","name":"XML to Object","property":"payload","attr":"","chr":"","x":1620,"y":1640,"wires":[["367cc798.afbc48"]]},{"id":"e3240da.05db4f","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/naimradio","method":"get","upload":false,"swaggerDoc":"","x":620,"y":1640,"wires":[["90e1669e.c73408"]]},{"id":"5ee7469e.d59338","type":"function","z":"40eacea7.33a8e8","name":"JSON msg gen","func":"var time = new Date();\n// global.set(msg.radio, JSON.stringify(\nglobal.set(msg.radio, \n\n       {\n        \"radio\": msg.radio,\n        \"lastupdate\": time,\n        \"mode\": msg.mode,\n        \"song_endtime\": msg.song_endtime,\n        \"data\": \n            {\n             \"metadata\": msg.payload, \n             \"title\": msg.title, \n             \"artist\": msg.artist,\n             \"composer\": msg.composer,\n             \"album\": msg.album,\n             \"performer\": msg.performer,\n             \"orchestra\":msg.orchestra,\n             \"conductor\": msg.conductor,\n             \"cover\": msg.cover,\n             \"label\": msg.label,\n             \"icecast_relay\": msg.sendtoicecast\n             }\n        }\n        )\n//)\n        \n    ;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2880,"y":580,"wires":[["9fb37efe.870ce","574c57f4.ddfbd8"]]},{"id":"9fb37efe.870ce","type":"switch","z":"40eacea7.33a8e8","name":"ICECAST update switch","property":"sendtoicecast","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":3090,"y":580,"wires":[["1985d5be.43759a"],[]]},{"id":"1985d5be.43759a","type":"function","z":"40eacea7.33a8e8","name":"Icecast server query","func":"//msg.payload = \"Maintenance message:to resume metadata service, restart stream\"\nmsg.topic = \"/metadata\";\nmsg.payload = encodeURIComponent (msg.payload);\nmsg.url = \"http://admin:PASSWORD@radio-metadata.fr:8000/admin/metadata?mount=/\" + msg.radio + \"&mode=updinfo&song=\" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":3340,"y":580,"wires":[["f448af8f.7545c"]]},{"id":"820cb2d9.639cf","type":"function","z":"40eacea7.33a8e8","name":"Set Song Mode","func":"msg.mode = \"song\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2500,"y":480,"wires":[["5ee7469e.d59338"]]},{"id":"8817da4b.0bc578","type":"function","z":"40eacea7.33a8e8","name":"Set Program Mode","func":"msg.mode = \"program\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2510,"y":800,"wires":[["5ee7469e.d59338"]]},{"id":"d05e90ff.1a587","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/naimclassical","method":"get","upload":false,"swaggerDoc":"","x":690,"y":1653,"wires":[["90e1669e.c73408"]]},{"id":"e32d6fbb.a42d1","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/naimjazz","method":"get","upload":false,"swaggerDoc":"","x":724,"y":1666,"wires":[["90e1669e.c73408"]]},{"id":"6822ef23.644c3","type":"inject","z":"40eacea7.33a8e8","name":"BBC Radio 2","props":[{"p":"url","v":"https://rms.api.bbc.co.uk/v2/services/bbc_radio_two/segments/latest?experience=domestic&offset=0&limit=1","vt":"str"},{"p":"radio","v":"bbcradio2","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.1","topic":"","x":1020,"y":1220,"wires":[["8b5594d5.5dc8a8"]]},{"id":"8b5594d5.5dc8a8","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":1220,"wires":[["78634335.3b7a1c"]]},{"id":"859459bf.27cb08","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1570,"y":1220,"wires":[["6068711f.75895"]]},{"id":"b155ab7f.776cf8","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1850,"y":1220,"wires":[["16cab8da.244e57"],["f20b9b54.3a8008"]]},{"id":"de1c518c.070a4","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/bbcradio2","method":"get","upload":false,"swaggerDoc":"","x":620,"y":1220,"wires":[["90e1669e.c73408"]]},{"id":"8968569b.49de48","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/list","method":"get","upload":false,"swaggerDoc":"","x":600,"y":180,"wires":[["90e1669e.c73408"]]},{"id":"b03b9b7.d03af68","type":"inject","z":"40eacea7.33a8e8","name":"INIT","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"0","topic":"","x":530,"y":40,"wires":[["e3286a27.66d2b8"]]},{"id":"e3286a27.66d2b8","type":"function","z":"40eacea7.33a8e8","name":"Set global variables incl. RADIO LIST and ICECAST RELAY setting","func":"// address and login credentials for Icecast Relay Server\n// (not configured yet in code, to be done)\n\nglobal.set (\"icecast_relay_login\",\"PASSWORD\");\nmsg.payload = global.get(\"icecast_relay_login\");\n\n\n// list of stations don't forget to update !\n\nvar address = \"http://radio-metadata.eu/\";\n\n//// add new stations here\n\nvar table = \n       [\n           {\"name\": \"FIP\", \"ID\":\"fip\"},\n           {\"name\": \"FIP Rock\", \"ID\":\"fip\"},\n           {\"name\": \"FIP Jazz\", \"ID\":\"fipjazz\"},\n           {\"name\": \"FIP Groove\", \"ID\":\"fipgroove\"},\n           {\"name\": \"FIP Monde\", \"ID\":\"fipmonde\"},\n           {\"name\": \"FIP Nouveautés\", \"ID\":\"fipnouveaute\"},\n           {\"name\": \"FIP Reggae\", \"ID\":\"fipreggae\"},\n           {\"name\": \"FIP Electro\", \"ID\":\"fipelectro\"},\n           {\"name\": \"FIP Pop\", \"ID\":\"fippop\"},\n           {\"name\": \"France Musique\", \"ID\":\"francemusique\"},\n           {\"name\": \"France Musique La Baroque\", \"ID\":\"francemusiquelabaroque\"},\n           {\"name\": \"France Musique Classique Easy\", \"ID\":\"francemusiqueclassiqueeasy\"},\n           {\"name\": \"France Musique Classique Plus\", \"ID\":\"francemusiqueclassiqueplus\"},\n           {\"name\": \"France Musique Concerts Radio France\", \"ID\":\"francemusiqueconcertsradiofrance\"},\n           {\"name\": \"France Musique la Jazz\", \"ID\":\"francemusiquelajazz\"},\n           {\"name\": \"France Musique la Contemporaine\", \"ID\":\"francemusiquelacontemporaine\"},\n           {\"name\": \"France Musique Ocora\", \"ID\":\"francemusiqueocora\"},\n           {\"name\": \"France Musique la B.O.\", \"ID\":\"francemusiquelabo\"},\n           {\"name\": \"France Musique Opéra\", \"ID\":\"francemusiqueopera\"},\n           {\"name\": \"France Inter\", \"ID\":\"franceinter\"},\n           {\"name\": \"BBC Radio 6 Music\", \"ID\":\"bbcradio6\"},\n           {\"name\": \"BBC Radio 2\", \"ID\":\"bbcradio2\"},\n           {\"name\": \"BBC Radio 1\", \"ID\":\"bbcradio1\"},\n           {\"name\": \"BBC Radio 3\", \"ID\":\"bbcradio3\"},\n           {\"name\": \"Classic 21 RTBF\", \"ID\":\"classic21\"},\n           {\"name\": \"Amazing Radio UK\", \"ID\":\"amazingradiouk\"},\n           {\"name\": \"Amazing Radio US\", \"ID\":\"amazingradious\"},\n           {\"name\": \"Naim Radio\", \"ID\":\"naimradio\"},\n           {\"name\": \"Naim Classical\", \"ID\":\"naimclassical\"},\n           {\"name\": \"Naim Jazz\", \"ID\":\"naimjazz\"},\n           {\"name\": \"KCSM\", \"ID\":\"kcsm\"},\n           {\"name\": \"Radio Paradise\", \"ID\":\"radioparadise\"},\n           {\"name\": \"Radio Paradise Mellow\", \"ID\":\"radioparadisemellow\"},\n           {\"name\": \"Radio Paradise Rock\", \"ID\":\"radioparadiserock\"},\n           {\"name\": \"Radio Paradise World/Etc\", \"ID\":\"radioparadiseworldetc\"},\n           {\"name\": \"Rondo Classic - Klasu Pro\", \"ID\":\"klasupro\"},\n           {\"name\": \"Radio 2.0 Valli di Bergamo\", \"ID\":\"radio20\"},\n           {\"name\": \"95bFM\", \"ID\":\"95bfm\"},\n           {\"name\": \"Sector radio - Classical\", \"ID\":\"nota\"},\n           {\"name\": \"Sector radio - Space\", \"ID\":\"space\"},\n           {\"name\": \"Sector radio - Progressive\", \"ID\":\"progressive\"},\n           {\"name\": \"Sector radio - 10s\", \"ID\":\"zed\"},\n           {\"name\": \"Sector radio - 80s\", \"ID\":\"geny\"},\n           {\"name\": \"Sector radio - 90s\", \"ID\":\"next\"},\n           {\"name\": \"440Hz\", \"ID\":\"440hz\"},\n           {\"name\": \"Fréquence 3\", \"ID\":\"frequence3\"},\n           {\"name\": \"Fréquence 3 - FM\", \"ID\":\"frequence3fm\"},\n           {\"name\": \"Fréquence 3 - Urban\", \"ID\":\"frequence3urban\"},\n           {\"name\": \"Fréquence 3 - Dance\", \"ID\":\"frequence3dance\"},\n           {\"name\": \"Fréquence 3 - Gold\", \"ID\":\"frequence3gold\"},\n           {\"name\": \"Fréquence 3 - World\", \"ID\":\"frequence3world\"},\n           {\"name\": \"Sing-Sing-Bis\", \"ID\":\"singsingbis\"},\n           {\"name\": \"The Cheese\", \"ID\":\"thecheese\"},\n           {\"name\": \"Chill Out Zone Plus\", \"ID\":\"chilloutzoneplus\"},\n           {\"name\": \"H2O\", \"ID\":\"h2o\"}\n          ];\n\nvar n= 0 ;\n\n// create API link for each station\n\nwhile (n<table.length)\n{\n    table[n].link = address + table[n].ID;\n    n = n+1;\n}\n\n// sort the list \n\ntable.sort((a, b) => (a.name > b.name) ? 1 : -1);\n\nglobal.set(\"list\", table);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":40,"wires":[[]]},{"id":"ddb01da4.3187e","type":"function","z":"40eacea7.33a8e8","name":"FIP song processing","func":"\nvar playing_item = msg.payload.data.now.playing_item;\nvar artist = playing_item.title;\nvar title = playing_item.subtitle;\n\nvar album = msg.payload.data.now.song.album;\nvar label = msg.payload.data.now.song.label;\nvar performer = msg.payload.data.now.song.interpreters;\nvar cover = msg.payload.data.now.song.cover;\n\nvar end_time = msg.payload.data.now.playing_item.end_time;\nvar now = Math.round((new Date())/1000);\n\nmsg.song_endtime = end_time;\nmsg.current_time = now;\nmsg.seconds_left = end_time - now;\n\n\nmsg.artist = artist;\nmsg.title = title;\nmsg.album = album;\nmsg.label = label;\nmsg.performer = performer;\nmsg.cover = cover;\n\nif (album != \"\") title = title + \" / \";\nif (artist != \"\") artist = artist + \" - \";\nmsg.payload = artist  + title + album ;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2220,"y":420,"wires":[["820cb2d9.639cf"]]},{"id":"1a5bfa39.580766","type":"function","z":"40eacea7.33a8e8","name":"FranceMusique song processing #1","func":"var playing_item = msg.payload.data.now.playing_item.song;\n\nif (playing_item == null)\n{\n    msg.payload = \"no data sent by Radio France\"\n}\nelse\n{\nvar title = playing_item.title;\nvar album = playing_item.album;\nvar artist = playing_item.subtitle;\nvar performer = playing_item.interpreters; \nvar composer = playing_item.compositors;\nvar orchestre = playing_item.orchestras;\nvar chef = playing_item.orchestra_leaders;\n\nvar end_time = msg.payload.data.now.playing_item.end_time;\nvar now = Math.round((new Date())/1000);\nmsg.song_endtime = end_time;\nmsg.current_time = now;\nmsg.seconds_left = end_time - now;\n\nmsg.title = title;\nmsg.album = album;\nmsg.composer = composer;\nmsg.cover = playing_item.cover;\nmsg.label = playing_item.label;\nmsg.artist = artist;\nmsg.performer = performer;\nmsg.conductor = chef;\nmsg.orchestra = orchestre;\n\nif ((composer != \"\") && (artist != \"\")) {composer = composer + \" / \"  }\nif (album != \"\") title = title + \" / \";\n\nmsg.end_time = end_time;\nmsg.current_time = now;\nmsg.seconds_left = end_time - now/1000;\n\nmsg.payload = composer + artist + \" - \" + title + album;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2270,"y":660,"wires":[["820cb2d9.639cf"]]},{"id":"658d71fe.88e1e","type":"function","z":"40eacea7.33a8e8","name":"FranceMusique song processing #2","func":"\nvar playing_item = msg.payload.data.now.playing_item.song;\nif (playing_item == null)\n{\n    msg.payload = \"no data sent by Radio France\";\n}\nelse\n{\nvar artist = playing_item.subtitle;\n\nvar title = playing_item.title;\nvar composer = playing_item.compositors;\nvar album = playing_item.album;\n\n\nvar end_time = msg.payload.data.now.playing_item.end_time;\nvar now = Math.round((new Date())/1000);\n\nmsg.song_endtime = end_time;\nmsg.current_time = now;\nmsg.seconds_left = end_time - now;\n\nmsg.artist = artist;\nmsg.title = title;\nmsg. album = album; \nmsg.composer = composer;\n\n\n\nif ((composer != \"\") && (artist != \"\")) {composer = composer + \" / \"  }\nif (album != \"\") title = title + \" / \";\nmsg.payload = composer + artist + \" - \" + title + album;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2270,"y":700,"wires":[["820cb2d9.639cf"]]},{"id":"f20b9b54.3a8008","type":"function","z":"40eacea7.33a8e8","name":"BBC No data","func":"msg.payload = \"no data from BBC\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2190,"y":1240,"wires":[["8817da4b.0bc578"]]},{"id":"6068711f.75895","type":"function","z":"40eacea7.33a8e8","name":"bbcradio2","func":"msg.radioname = \"BBC Radio 2\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":1220,"wires":[["b155ab7f.776cf8"]]},{"id":"9b87cb88.4c0718","type":"inject","z":"40eacea7.33a8e8","name":"BBC Radio 1","props":[{"p":"url","v":"https://rms.api.bbc.co.uk/v2/services/bbc_radio_one/segments/latest?experience=domestic&offset=0&limit=1","vt":"str"},{"p":"radio","v":"bbcradio1","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2","topic":"","x":1020,"y":1180,"wires":[["d81af4bd.bf1f58"]]},{"id":"d81af4bd.bf1f58","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":1180,"wires":[["a11b36d8.b76c9"]]},{"id":"e529de08.99d8","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1570,"y":1180,"wires":[["9f44d745.5081c8"]]},{"id":"9f44d745.5081c8","type":"function","z":"40eacea7.33a8e8","name":"bbcradio1","func":"msg.radioname = \"BBC Radio 1\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":1180,"wires":[["4aa01a62.4fbc54"]]},{"id":"4aa01a62.4fbc54","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1850,"y":1180,"wires":[["16cab8da.244e57"],["f20b9b54.3a8008"]]},{"id":"f22424a2.da7a18","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/bbcradio1","method":"get","upload":false,"swaggerDoc":"","x":620,"y":1180,"wires":[["90e1669e.c73408"]]},{"id":"caf6ed74.86caa","type":"inject","z":"40eacea7.33a8e8","name":"BBC Radio 3","props":[{"p":"url","v":"https://rms.api.bbc.co.uk/v2/services/bbc_radio_three/segments/latest?experience=domestic&offset=0&limit=1","vt":"str"},{"p":"radio","v":"bbcradio3","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.2","topic":"","x":1020,"y":1260,"wires":[["83e4fc2e.15ca"]]},{"id":"83e4fc2e.15ca","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":1260,"wires":[["5aac20f6.0307a8"]]},{"id":"94c7d1ab.dce65","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1570,"y":1260,"wires":[["1490d008.535b9"]]},{"id":"1490d008.535b9","type":"function","z":"40eacea7.33a8e8","name":"bbcradio3","func":"msg.radioname = \"BBC Radio 3\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1710,"y":1260,"wires":[["830eda07.302828"]]},{"id":"830eda07.302828","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.data","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1850,"y":1260,"wires":[["16cab8da.244e57"],["f20b9b54.3a8008"]]},{"id":"f9bd259.8b932d8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/bbcradio3","method":"get","upload":false,"swaggerDoc":"","x":620,"y":1260,"wires":[["90e1669e.c73408"]]},{"id":"b2f56603.7b6fc8","type":"function","z":"40eacea7.33a8e8","name":"AllMetadataTable 2 JSON","func":"\nmsg.payload = JSON.stringify(global.get(\"AllMetadataTable\"));\n\nmsg.ip = msg.req.ip;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":140,"wires":[["77640728.986a48"]]},{"id":"66324216.e65d2c","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/all","method":"get","upload":false,"swaggerDoc":"","x":590,"y":140,"wires":[["b2f56603.7b6fc8"]]},{"id":"e809a4f4.879868","type":"inject","z":"40eacea7.33a8e8","name":"Open Broadcast","props":[{"p":"url","v":"https://www.openbroadcast.ch/api/v2/onair/schedule/?format=json&limit=1","vt":"str"},{"p":"radio","v":"openbroadcast","vt":"str"},{"p":"sendtoicecast","v":"true","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.8","topic":"","x":1030,"y":1720,"wires":[["6220f9b8.4cba38"]]},{"id":"6220f9b8.4cba38","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":1720,"wires":[["71bd5ac9.ade9c4"]]},{"id":"5665cd.7e387a34","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1590,"y":1720,"wires":[["4a16839c.c801fc"]]},{"id":"4a16839c.c801fc","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1770,"y":1720,"wires":[["8a70fd97.014b2"],[]]},{"id":"8a70fd97.014b2","type":"function","z":"40eacea7.33a8e8","name":"open broadcast processing","func":"\nvar playing_item = msg.payload.results[0];\n\nif ((playing_item.onair == true) && (playing_item.item != null))\n{\nvar artist = playing_item.item.artist.name;\nvar title = playing_item.item.name;\n// var album = playing_item.xxxxx ;\n\nif (artist == null) artist = \"\";\nif (title == null) title = \"\";\n// if (album == null) album = \"\";\n\nmsg.artist = artist;\nmsg.title = title;\nmsg.label = playing_item.item.label.name;\n// msg.album = album ;\n\n// if (album != \"\") title = title + \" / \";\n\nmsg.payload = artist + \" - \" + title \n// + album\n;\n\nmsg.song_endtime = Math.round(((new Date(playing_item.time_end)).getTime())/1000);\nmsg.secondsleft = playing_item.ends_in;\n\nmsg.mode = \"song\";\n}\nelse\n{ \n    msg.payload = \"Open Broadcast\";\n    msg.mode = \"program\"\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2000,"y":1720,"wires":[["5ee7469e.d59338"]]},{"id":"f1b23dc4.7f833","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/openbroadcast","method":"get","upload":false,"swaggerDoc":"","x":630,"y":1720,"wires":[["90e1669e.c73408"]]},{"id":"7fa805f.18f9efc","type":"comment","z":"40eacea7.33a8e8","name":"TO DO","info":"Mac FM https://1063macfm.com/\n(That last one’s funny. It has two .m3u8 streams which Roon handles ok (!) but no metadata, plus an mp3 stream which carries data but is always out of sync (1 minute difference)).\n\n\nhttps://rondolehti.fi/\nhttps://rondolehti.fi/i-radiot-test?playlist=viva\nhttps://rondolehti.fi/i-radiot-test?playlist=klasu\n(klasupro done)\n\nChill Out Zone Plus\nhttps://chillout.zone:8080/api/v2/history/?format=json&limit=1&offset=0&server=2\n\n\nIntense Radio\n\n\nDJ ZOG\n\n\n\nHi On Line (test)\n\n\nHard Dance Hits\n\n\n90s Eurodance\n\n\nLOUNGE\n\n\nTME Folk Radio\n\n\n","x":510,"y":120,"wires":[]},{"id":"5eb03ed6.3b68e","type":"inject","z":"40eacea7.33a8e8","name":"KCSM","props":[{"p":"url","v":"https://streamdb9web.securenetsystems.net/player_status_update/KCSM.xml","vt":"str"},{"p":"radio","v":"kcsm","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"2.9","topic":"","x":1000,"y":1820,"wires":[["8f5912e2.6dff5"]]},{"id":"8f5912e2.6dff5","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":1820,"wires":[["ec0b9e79.3d9a4"]]},{"id":"e8711bb5.e26cb8","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.playlist","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1750,"y":1820,"wires":[["742f9a43.b37bf4"],[]]},{"id":"742f9a43.b37bf4","type":"function","z":"40eacea7.33a8e8","name":"kcsm processing","func":"\nvar playing_item = msg.payload.playlist;\n\nvar artist = playing_item.artist[0];\nvar title = playing_item.title[0];\nvar album = playing_item.album[0];\nvar cover = playing_item.cover[0];\n\nif (artist == null) artist = \"\";\nif (title == null) title = \"\";\nif (album == null) album = \"\";\nif (cover == null) cover = \"\";\n\nmsg.artist = artist;\nmsg.title = title;\nmsg.album = album ;\nmsg.cover = cover; \n\nif (album != \"\") title = title + \" / \";\n\nmsg.payload = artist + \" - \" + title + album;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":1820,"wires":[["820cb2d9.639cf"]]},{"id":"ec0b9e79.3d9a4","type":"xml","z":"40eacea7.33a8e8","name":"","property":"payload","attr":"","chr":"","x":1570,"y":1820,"wires":[["e8711bb5.e26cb8"]]},{"id":"cf6d90bf.cfe84","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/kcsm","method":"get","upload":false,"swaggerDoc":"","x":600,"y":1820,"wires":[["90e1669e.c73408"]]},{"id":"fe911079.079b7","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/radioparadise","method":"get","upload":false,"swaggerDoc":"","x":630,"y":1880,"wires":[["90e1669e.c73408"]]},{"id":"5e8db432.ddb9fc","type":"inject","z":"40eacea7.33a8e8","name":"Radio Paradise","props":[],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","x":1020,"y":1880,"wires":[["ef0226c5.0bdea8","6e064dc7.7bc584","181c427c.67e24e","c203e6c3.eaeb68"]]},{"id":"5afbe3f6.73335c","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1430,"y":1920,"wires":[["fce6a0a0.66a8d"]]},{"id":"5c139f9e.6fd87","type":"function","z":"40eacea7.33a8e8","name":"radioparadise processing","func":"var item = msg.payload;\n\nvar artist = item.artist;\nvar title = item.title;\nvar album = item.title;\n\nif (artist == null) artist = \"\";\nif (title == null) title = \"\";\nif (album == null) album = \"\";\n\nmsg.artist = artist;\nmsg.title = title;\nmsg.album = album ;\n\nif (album != \"\") title = title + \" / \";\n\nmsg.payload = artist + \" - \" + title + album;\nmsg.sendtoicecast = false;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2010,"y":1920,"wires":[["820cb2d9.639cf"]]},{"id":"1e01018b.d1f69e","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1790,"y":1920,"wires":[["21c5c3ca.0583dc","5c139f9e.6fd87"]]},{"id":"ef0226c5.0bdea8","type":"change","z":"40eacea7.33a8e8","name":"Main","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.radioparadise.com/api/now_playing?chan=0","tot":"str"},{"t":"set","p":"radio","pt":"msg","to":"radioparadise","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":1920,"wires":[["5afbe3f6.73335c"]]},{"id":"181c427c.67e24e","type":"change","z":"40eacea7.33a8e8","name":"Rock","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.radioparadise.com/api/now_playing?chan=2","tot":"str"},{"t":"set","p":"radio","pt":"msg","to":"radioparadiserock","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":2240,"wires":[["ca6a42e3.4d9bb"]]},{"id":"6e064dc7.7bc584","type":"change","z":"40eacea7.33a8e8","name":"Mellow","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.radioparadise.com/api/now_playing?chan=1","tot":"str"},{"t":"set","p":"radio","pt":"msg","to":"radioparadisemellow","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1220,"y":2080,"wires":[["4b9e51ce.48cba"]]},{"id":"c203e6c3.eaeb68","type":"change","z":"40eacea7.33a8e8","name":"WorldEtc","rules":[{"t":"set","p":"url","pt":"msg","to":"https://api.radioparadise.com/api/now_playing?chan=3","tot":"str"},{"t":"set","p":"radio","pt":"msg","to":"radioparadiseworldetc","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1220,"y":2380,"wires":[["899352a6.f07d68"]]},{"id":"fce6a0a0.66a8d","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1570,"y":1920,"wires":[["1e01018b.d1f69e"],["e50a1fd0.2de31"]]},{"id":"e50a1fd0.2de31","type":"delay","z":"40eacea7.33a8e8","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1440,"y":1980,"wires":[["5afbe3f6.73335c"]]},{"id":"21c5c3ca.0583dc","type":"function","z":"40eacea7.33a8e8","name":"wait4nextsong","func":"msg.delay = msg.payload.time*1000;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":1980,"wires":[["2e04ac28.07b184"]]},{"id":"2e04ac28.07b184","type":"delay","z":"40eacea7.33a8e8","name":"timer until next song","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1480,"y":2020,"wires":[["5afbe3f6.73335c"]]},{"id":"4b9e51ce.48cba","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":2080,"wires":[["2aded1f4.1146a6"]]},{"id":"dfe9ff92.13af9","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1810,"y":2080,"wires":[["8cef68e3.d29d68","5c139f9e.6fd87"]]},{"id":"8cef68e3.d29d68","type":"function","z":"40eacea7.33a8e8","name":"wait4nextsong","func":"msg.delay = msg.payload.time*1000;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1860,"y":2140,"wires":[["e52ee2b2.04cf4"]]},{"id":"763d9368.25018c","type":"delay","z":"40eacea7.33a8e8","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1460,"y":2140,"wires":[["4b9e51ce.48cba"]]},{"id":"e52ee2b2.04cf4","type":"delay","z":"40eacea7.33a8e8","name":"timer until next song","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1500,"y":2180,"wires":[["4b9e51ce.48cba"]]},{"id":"ca6a42e3.4d9bb","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":2240,"wires":[["e345a9fe.877598"]]},{"id":"e345a9fe.877598","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1590,"y":2240,"wires":[["6aa8c444.4675f4"],["fabab338.f9a228"]]},{"id":"6aa8c444.4675f4","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1810,"y":2240,"wires":[["879bf33a.8eaa48","5c139f9e.6fd87"]]},{"id":"879bf33a.8eaa48","type":"function","z":"40eacea7.33a8e8","name":"wait4nextsong","func":"msg.delay = msg.payload.time*1000;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1840,"y":2300,"wires":[["e000f3ee.2f152"]]},{"id":"fabab338.f9a228","type":"delay","z":"40eacea7.33a8e8","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1460,"y":2300,"wires":[["ca6a42e3.4d9bb"]]},{"id":"e000f3ee.2f152","type":"delay","z":"40eacea7.33a8e8","name":"timer until next song","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1500,"y":2340,"wires":[["ca6a42e3.4d9bb"]]},{"id":"899352a6.f07d68","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":2380,"wires":[["f30c9d73.02c91"]]},{"id":"f30c9d73.02c91","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1590,"y":2380,"wires":[["d688fd5b.0b48"],["be73ef7.63e289"]]},{"id":"d688fd5b.0b48","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1810,"y":2380,"wires":[["30b7fd62.79ca72","5c139f9e.6fd87"]]},{"id":"30b7fd62.79ca72","type":"function","z":"40eacea7.33a8e8","name":"wait4nextsong","func":"msg.delay = msg.payload.time*1000;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1860,"y":2440,"wires":[["8afe3961.db0838"]]},{"id":"be73ef7.63e289","type":"delay","z":"40eacea7.33a8e8","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1460,"y":2440,"wires":[["899352a6.f07d68"]]},{"id":"8afe3961.db0838","type":"delay","z":"40eacea7.33a8e8","name":"timer until next song","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1500,"y":2480,"wires":[["899352a6.f07d68"]]},{"id":"c8fa05e4.ffd128","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/radioparadisemellow","method":"get","upload":false,"swaggerDoc":"","x":650,"y":1920,"wires":[["90e1669e.c73408"]]},{"id":"731c438c.ffab6c","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/radioparadiserock","method":"get","upload":false,"swaggerDoc":"","x":640,"y":1960,"wires":[["90e1669e.c73408"]]},{"id":"2281a4b8.16f10c","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/radioparadiseworldetc","method":"get","upload":false,"swaggerDoc":"","x":660,"y":2000,"wires":[["90e1669e.c73408"]]},{"id":"f1e38ae1.61943","type":"inject","z":"40eacea7.33a8e8","name":"Rondo Classic - Klasu Pro","props":[{"p":"url","v":"https://rondolehti.fi/i-radiot-test?playlist=klasupro","vt":"str"},{"p":"radio","v":"klasupro","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3","topic":"","x":1060,"y":2560,"wires":[["4b53074.fbb21f8"]]},{"id":"4b53074.fbb21f8","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":2560,"wires":[["39b4e9d4.0125e6"]]},{"id":"a338cce9.1b037","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1550,"y":2560,"wires":[["2851d08f.364578"]]},{"id":"2851d08f.364578","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1670,"y":2560,"wires":[["c77dbbd4.bee46"],[]]},{"id":"c77dbbd4.bee46","type":"function","z":"40eacea7.33a8e8","name":"klausupro processing","func":"\nvar item = msg.payload;\n\nvar composer = item[1][1];\nvar titleartist = item[2][1];\n\ntitleartist = titleartist.split(\" / \");\n\nvar artist = titleartist[1];\nvar title = titleartist[0];\n\nif (artist == null) artist = \"\";\nif (title == null) title = \"\";\nif (composer == null) composer = \"\";\n\nmsg.artist = artist;\nmsg.title = title;\nmsg.composer = composer;\n\nif ((composer != \"\") && (artist != \"\")) {composer = composer + \" / \"  }\n\nmsg.payload = composer + artist + \" - \" + title ;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":2560,"wires":[["820cb2d9.639cf"]]},{"id":"20847736.297da","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/klasupro","method":"get","upload":false,"swaggerDoc":"","x":670,"y":2560,"wires":[["90e1669e.c73408"]]},{"id":"a8a95d55.347078","type":"inject","z":"40eacea7.33a8e8","name":"Radio 2.0","props":[{"p":"url","v":"https://www.radioduepuntozero.it/now-playing.php","vt":"str"},{"p":"radio","v":"radio20","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.1","topic":"","x":1010,"y":2600,"wires":[["c71ade44.e20d88"]]},{"id":"c71ade44.e20d88","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":2600,"wires":[["bdf04597.95a378"]]},{"id":"2016e9da.489726","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1650,"y":2600,"wires":[["2093e64.2d1a11a"],["76e10273.5b421c"]]},{"id":"2093e64.2d1a11a","type":"function","z":"40eacea7.33a8e8","name":"radio20 processing","func":"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":2600,"wires":[["820cb2d9.639cf"]]},{"id":"13cc0849.1bdeb","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/radio20","method":"get","upload":false,"swaggerDoc":"","x":670,"y":2600,"wires":[["90e1669e.c73408"]]},{"id":"72ef42d4.ca367c","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/95bfm","method":"get","upload":false,"swaggerDoc":"","x":670,"y":2640,"wires":[["90e1669e.c73408"]]},{"id":"864eee7f.cc1be","type":"inject","z":"40eacea7.33a8e8","name":"95bFM","props":[{"p":"url","v":"https://95bfm.com/block_refresh/views/playlist-block_2/node/15","vt":"str"},{"p":"radio","v":"95bfm","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.2","topic":"","x":1000,"y":2640,"wires":[["fb945a1e.6f8528"]]},{"id":"fb945a1e.6f8528","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":2638,"wires":[["194562ea.ece2dd"]]},{"id":"26f9500.67ccfb","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1650,"y":2640,"wires":[["7492d51b.5e3b2c"],["df50345d.9ea8b8"]]},{"id":"7492d51b.5e3b2c","type":"function","z":"40eacea7.33a8e8","name":"95bfm processing","func":"var item = msg.payload;\n\nitem = item.split('<span class=\"field-content\">');\nif (item.length < 2)\n{\n    msg.payload = \"no data from 95bFM\"\n}\nelse\n{\n    item = item[1].split('</span>');\n    msg.payload = item[0];\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1970,"y":2640,"wires":[["820cb2d9.639cf"]]},{"id":"76e10273.5b421c","type":"function","z":"40eacea7.33a8e8","name":"","func":"msg.payload = \"no metadata\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":2620,"wires":[["2093e64.2d1a11a"]]},{"id":"df50345d.9ea8b8","type":"function","z":"40eacea7.33a8e8","name":"","func":"msg.payload = \"no metadata\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":2660,"wires":[["7492d51b.5e3b2c"]]},{"id":"1615dc97.964d23","type":"inject","z":"40eacea7.33a8e8","name":"Sector Radio","props":[{"p":"url","v":"http://sectorradio.ru/api/track.php?channel=","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.3","topic":"","x":1020,"y":2700,"wires":[["2dae47c7.749008","bac59d75.18d84","8ac93d62.dd16d","c8f4edf2.27b69","73b5597a.8a0068","c582c680.9f1c78"]]},{"id":"2dae47c7.749008","type":"change","z":"40eacea7.33a8e8","name":"progressive","rules":[{"t":"set","p":"radio","pt":"msg","to":"progressive","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":2700,"wires":[["c00a2d4c.de4e7"]]},{"id":"bac59d75.18d84","type":"change","z":"40eacea7.33a8e8","name":"space","rules":[{"t":"set","p":"radio","pt":"msg","to":"space","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1190,"y":2740,"wires":[["c00a2d4c.de4e7"]]},{"id":"8ac93d62.dd16d","type":"change","z":"40eacea7.33a8e8","name":"nota (classical)","rules":[{"t":"set","p":"radio","pt":"msg","to":"nota","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1220,"y":2780,"wires":[["c00a2d4c.de4e7"]]},{"id":"c8f4edf2.27b69","type":"change","z":"40eacea7.33a8e8","name":"geny (80s)","rules":[{"t":"set","p":"radio","pt":"msg","to":"geny","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":2820,"wires":[["c00a2d4c.de4e7"]]},{"id":"c582c680.9f1c78","type":"change","z":"40eacea7.33a8e8","name":"zed (10s)","rules":[{"t":"set","p":"radio","pt":"msg","to":"zed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1200,"y":2900,"wires":[["c00a2d4c.de4e7"]]},{"id":"73b5597a.8a0068","type":"change","z":"40eacea7.33a8e8","name":"next (90s)","rules":[{"t":"set","p":"radio","pt":"msg","to":"next","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1200,"y":2860,"wires":[["c00a2d4c.de4e7"]]},{"id":"c00a2d4c.de4e7","type":"function","z":"40eacea7.33a8e8","name":"","func":"msg.url = msg.url+msg.radio;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1400,"y":2780,"wires":[["688e0a7.e66aaf4"]]},{"id":"688e0a7.e66aaf4","type":"http request","z":"40eacea7.33a8e8","name":"http req Sector","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1560,"y":2780,"wires":[["1906a2b3.21fed5"]]},{"id":"4d4f1339.8d087c","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1830,"y":2780,"wires":[["7ad43c96.99cae4"]]},{"id":"7ad43c96.99cae4","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1950,"y":2780,"wires":[["f01baeb6.0c7c2"],[]]},{"id":"f01baeb6.0c7c2","type":"function","z":"40eacea7.33a8e8","name":"Sector Radio processing","func":"\n\nvar artist = msg.payload.artist;\nvar title = msg.payload.title;\n\nif (artist == null) artist = \"\";\nif (title == null) title = \"\";\n\nmsg.artist = artist;\nmsg.title = title;\n\nif (artist != \"\") artist = artist + \" - \";\n\nmsg.payload = artist +title ;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2150,"y":2780,"wires":[["820cb2d9.639cf"]]},{"id":"574c57f4.ddfbd8","type":"debug","z":"40eacea7.33a8e8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"radio","targetType":"msg","statusVal":"","statusType":"auto","x":3040,"y":740,"wires":[]},{"id":"c3c96817.7c4b78","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/progressive","method":"get","upload":false,"swaggerDoc":"","x":680,"y":2700,"wires":[["90e1669e.c73408"]]},{"id":"75f2caf7.816554","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/space","method":"get","upload":false,"swaggerDoc":"","x":670,"y":2740,"wires":[["90e1669e.c73408"]]},{"id":"ffc6be93.fac82","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/nota","method":"get","upload":false,"swaggerDoc":"","x":660,"y":2780,"wires":[["90e1669e.c73408"]]},{"id":"165dd710.df1b59","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/geny","method":"get","upload":false,"swaggerDoc":"","x":660,"y":2820,"wires":[["90e1669e.c73408"]]},{"id":"f29e2b15.521d68","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/next","method":"get","upload":false,"swaggerDoc":"","x":660,"y":2860,"wires":[["90e1669e.c73408"]]},{"id":"26cdfb84.f61d84","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/zed","method":"get","upload":false,"swaggerDoc":"","x":660,"y":2900,"wires":[["90e1669e.c73408"]]},{"id":"7ec4188f.0a8bb8","type":"inject","z":"40eacea7.33a8e8","name":"440Hz","props":[{"p":"url","v":"https://440hz-radio.de/index.php?ID=9&task=ticker&js=true","vt":"str"},{"p":"radio","v":"440hz","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.4","topic":"","x":1000,"y":2960,"wires":[["674bf1fc.065578"]]},{"id":"674bf1fc.065578","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":2960,"wires":[["3dea7c31.18d5cc"]]},{"id":"965c966.f8b0368","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1730,"y":2960,"wires":[["938f54a1.ec3478"],[]]},{"id":"938f54a1.ec3478","type":"function","z":"40eacea7.33a8e8","name":"440hz processing","func":"var item = msg.payload;\n\nitem = item.split('</p>');\nitem = item[0].split('<p class=\"songanzeige\">Es läuft: ');\nmsg.payload = item[1];\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1991,"y":2960,"wires":[["820cb2d9.639cf"]]},{"id":"7f23c895.09b4b8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/440hz","method":"get","upload":false,"swaggerDoc":"","x":670,"y":2960,"wires":[["90e1669e.c73408"]]},{"id":"2aded1f4.1146a6","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1590,"y":2080,"wires":[["dfe9ff92.13af9"],["763d9368.25018c"]]},{"id":"67872725.005c38","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1390,"y":1820,"wires":[[],["b7c71385.0a1288"]]},{"id":"b7c71385.0a1288","type":"function","z":"40eacea7.33a8e8","name":"No HTTP response","func":"\n    msg.payload = \"Error (failed http request)\";\n    msg.mode = \"error\"\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2510,"y":1200,"wires":[["5ee7469e.d59338"]]},{"id":"71bd5ac9.ade9c4","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":1720,"wires":[["5665cd.7e387a34"],["b7c71385.0a1288"]]},{"id":"dec9aac9.c9882","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":1640,"wires":[["b7b424d5.62e798"],["b7c71385.0a1288"]]},{"id":"cbdb743e.ffb45","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":1600,"wires":[["b817f998.d41dd"],["b7c71385.0a1288"]]},{"id":"a377a9ad.3059f","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":1560,"wires":[["23ee132a.c57e5c"],["b7c71385.0a1288"]]},{"id":"f92968fc.65c1c","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1350,"y":1500,"wires":[["29442b66.2f7ac4"],[]]},{"id":"39b4e9d4.0125e6","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":2560,"wires":[["a338cce9.1b037"],["b7c71385.0a1288"]]},{"id":"bdf04597.95a378","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1450,"y":2600,"wires":[["2016e9da.489726"],["b7c71385.0a1288"]]},{"id":"194562ea.ece2dd","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1459,"y":2640,"wires":[["26f9500.67ccfb"],["b7c71385.0a1288"]]},{"id":"1906a2b3.21fed5","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1710,"y":2780,"wires":[["4d4f1339.8d087c"],["b7c71385.0a1288"]]},{"id":"3dea7c31.18d5cc","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1450,"y":2960,"wires":[["965c966.f8b0368"],["b7c71385.0a1288"]]},{"id":"e70f0408.e01ea","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":1340,"wires":[["24848a6e.180e6e"],["b7c71385.0a1288"]]},{"id":"5aac20f6.0307a8","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":1260,"wires":[["94c7d1ab.dce65"],["b7c71385.0a1288"]]},{"id":"78634335.3b7a1c","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":1220,"wires":[["859459bf.27cb08"],["b7c71385.0a1288"]]},{"id":"a11b36d8.b76c9","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":1180,"wires":[["e529de08.99d8"],["b7c71385.0a1288"]]},{"id":"3a8ad8ec.34bdd8","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":1120,"wires":[["5e6d3184.14c8b"],["b7c71385.0a1288"]]},{"id":"fac0ed61.668be8","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":280,"wires":[["5d5efc29.760cac"],["b7c71385.0a1288"]]},{"id":"a61da39a.cbeeb","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":320,"wires":[["6bfecc7e.5c26f4"],["b7c71385.0a1288"]]},{"id":"da3454fa.b6fb88","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":360,"wires":[["eecc39e5.2e94a8"],["b7c71385.0a1288"]]},{"id":"61890408.0770cc","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":400,"wires":[["80893345.bb4ac8"],["b7c71385.0a1288"]]},{"id":"b172983.0d019e8","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":440,"wires":[["4fdd44f6.a9092c"],["b7c71385.0a1288"]]},{"id":"9daa3133.12231","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":480,"wires":[["315d2e77.bd657a"],["b7c71385.0a1288"]]},{"id":"63b94ac9.6c0e4c","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":520,"wires":[["c0f001eb.c7b658"],["b7c71385.0a1288"]]},{"id":"2f0ffe79.e671ea","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":560,"wires":[["1b9ac99c.c42576"],["b7c71385.0a1288"]]},{"id":"dc336e8.852891","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1510,"y":600,"wires":[["2b6e5ecd.005b42"],["b7c71385.0a1288"]]},{"id":"bf2685d4.a25fb8","type":"inject","z":"40eacea7.33a8e8","name":"Fréquence 3","props":[{"p":"url","v":"https://api2.frequence3.net/v2/mobile/getCurrentTracks","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.5","topic":"","x":1020,"y":3000,"wires":[["3f2f620b.0a1cfe"]]},{"id":"7844be55.c15a1","type":"change","z":"40eacea7.33a8e8","name":"frequence3","rules":[{"t":"set","p":"radio","pt":"msg","to":"frequence3","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"payload[0]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1770,"y":3000,"wires":[["ddce3ec4.1fa11"]]},{"id":"3f2f620b.0a1cfe","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1190,"y":3000,"wires":[["c0eb5078.3a2d6"]]},{"id":"c0eb5078.3a2d6","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1370,"y":3000,"wires":[["64d521b0.6a2c3"],["b7c71385.0a1288"]]},{"id":"c7c49c6b.3a84","type":"change","z":"40eacea7.33a8e8","name":"frequence3gold","rules":[{"t":"set","p":"radio","pt":"msg","to":"frequence3gold","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"payload[4]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1780,"y":3040,"wires":[["ddce3ec4.1fa11"]]},{"id":"6abbb3ab.e9f03c","type":"change","z":"40eacea7.33a8e8","name":"frequence3urban","rules":[{"t":"set","p":"radio","pt":"msg","to":"frequence3urban","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"payload[1]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1790,"y":3080,"wires":[["ddce3ec4.1fa11"]]},{"id":"ddce3ec4.1fa11","type":"function","z":"40eacea7.33a8e8","name":"Frequence 3 processing","func":"var item = msg.payload;\n\nif (item.track != undefined)\n{\nmsg.payload = item.track.track;\nmsg.title = item.track.title;\nmsg.artist = item.track.artist;\n}\nelse\n{\nmsg.payload = \"no song data\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2150,"y":3060,"wires":[["820cb2d9.639cf"]]},{"id":"64d521b0.6a2c3","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1570,"y":3000,"wires":[["7844be55.c15a1","c7c49c6b.3a84","6abbb3ab.e9f03c","9438d137.cebde","9ac16710.cda248","5d93cff7.64517"]]},{"id":"9438d137.cebde","type":"change","z":"40eacea7.33a8e8","name":"frequence3fm","rules":[{"t":"set","p":"radio","pt":"msg","to":"frequence3fm","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"payload[2]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1780,"y":3120,"wires":[["ddce3ec4.1fa11"]]},{"id":"9ac16710.cda248","type":"change","z":"40eacea7.33a8e8","name":"frequence3dance","rules":[{"t":"set","p":"radio","pt":"msg","to":"frequence3dance","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"payload[3]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1790,"y":3160,"wires":[["ddce3ec4.1fa11"]]},{"id":"5d93cff7.64517","type":"change","z":"40eacea7.33a8e8","name":"frequence3world","rules":[{"t":"set","p":"radio","pt":"msg","to":"frequence3world","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"payload[5]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1780,"y":3200,"wires":[["ddce3ec4.1fa11"]]},{"id":"e0381461.0c9b68","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/frequence3","method":"get","upload":false,"swaggerDoc":"","x":680,"y":3000,"wires":[["90e1669e.c73408"]]},{"id":"237a376b.5ea018","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/frequence3gold","method":"get","upload":false,"swaggerDoc":"","x":700,"y":3040,"wires":[["90e1669e.c73408"]]},{"id":"e2260842.e66fb8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/frequence3urban","method":"get","upload":false,"swaggerDoc":"","x":700,"y":3080,"wires":[["90e1669e.c73408"]]},{"id":"a29936c7.e839b8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/frequence3fm","method":"get","upload":false,"swaggerDoc":"","x":690,"y":3120,"wires":[["90e1669e.c73408"]]},{"id":"d483a728.a4f008","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/frequence3dance","method":"get","upload":false,"swaggerDoc":"","x":700,"y":3160,"wires":[["90e1669e.c73408"]]},{"id":"ce207b70.a782c8","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/frequence3world","method":"get","upload":false,"swaggerDoc":"","x":700,"y":3200,"wires":[["90e1669e.c73408"]]},{"id":"a90fd937.cbe8b8","type":"function","z":"40eacea7.33a8e8","name":"Update AllMetadataTable","func":"// build table of all stations with metadata \n\nvar n= 0 ;\nvar table = global.get(\"list\");\nvar new_table = [];\nvar lastupdate;\nvar metadata;\nvar icecast_relay;\nvar name;\n\nwhile (n<table.length)\n{\n    lastupdate = global.get(table[n].ID).lastupdate;\n    metadata = global.get(table[n].ID).data.metadata;\n    icecast_relay = global.get(table[n].ID).data.icecast_relay;\n\n    name = table[n].name;\n    new_table[n]={};\n    new_table[n].name = name;\n    new_table[n].metadata =  metadata;\n    new_table[n].lastupdate = lastupdate;\n    new_table[n].icecast_relay = icecast_relay;\n    n = n+1;\n}\n\nglobal.set(\"AllMetadataTable\",new_table);\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":80,"wires":[[]]},{"id":"bf007bb5.cea7e8","type":"inject","z":"40eacea7.33a8e8","name":"Every 6 sec","props":[],"repeat":"6","crontab":"","once":true,"onceDelay":"5","topic":"","x":550,"y":80,"wires":[["a90fd937.cbe8b8"]]},{"id":"3e4c3427.0f223c","type":"inject","z":"40eacea7.33a8e8","name":"Sing-Sing-Bis","props":[{"p":"url","v":"http://www.sing-sing-bis.org/navi/titre/serverSideEvent.php","vt":"str"},{"p":"radio","v":"singsingbis","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.6","topic":"","x":1020,"y":3260,"wires":[["2021477.9e145b8"]]},{"id":"2021477.9e145b8","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1270,"y":3260,"wires":[["af705d26.cd564"]]},{"id":"af705d26.cd564","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1451,"y":3260,"wires":[["eb144c8c.e1924"],["b7c71385.0a1288"]]},{"id":"eb144c8c.e1924","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1730,"y":3260,"wires":[["1fec22b7.f035fd"],[]]},{"id":"1fec22b7.f035fd","type":"function","z":"40eacea7.33a8e8","name":"singsingbis processing","func":"var item = msg.payload;\n\nitem = item.split('data:');\nif (item.length < 2)\n{\n    msg.payload = \"no data from Sing-Sing-Bis\"\n}\nelse\n{\n    msg.payload = item[1].trim();\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2001,"y":3260,"wires":[["820cb2d9.639cf"]]},{"id":"396b292.4ccc8d6","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/singsingbis","method":"get","upload":false,"swaggerDoc":"","x":680,"y":3260,"wires":[["90e1669e.c73408"]]},{"id":"716be03e.6fef7","type":"inject","z":"40eacea7.33a8e8","name":"The Cheese","props":[{"p":"url","v":"https://ww.api.iheart.com/api/v3/live-meta/stream/8847/currentTrackMeta?defaultMetadata=true","vt":"str"},{"p":"radio","v":"thecheese","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.7","topic":"","x":1010,"y":3320,"wires":[["a5c428d7.98c8f8"]]},{"id":"a5c428d7.98c8f8","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":3320,"wires":[["19729ab.6f7f465"]]},{"id":"19729ab.6f7f465","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":3320,"wires":[["d2a7aeee.1753c"],["b7c71385.0a1288"]]},{"id":"d2a7aeee.1753c","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1550,"y":3320,"wires":[["63315760.a041b8"]]},{"id":"63315760.a041b8","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1670,"y":3320,"wires":[["bf74581e.067e28"],[]]},{"id":"bf74581e.067e28","type":"function","z":"40eacea7.33a8e8","name":"thecheese processing","func":"\nvar item = msg.payload;\n\n\nvar artist = item.artist;\nvar title = item.title;\nvar album = item.album;\n\nif (artist == null) artist = \"\";\nif (title == null) title = \"\";\nif (album == null) composer = \"\";\n\nmsg.artist = artist;\nmsg.title = title;\nmsg.album = album;\nmsg.song_endtime = Math.round(item.endTime/1000);\nmsg.cover = item.imagePath;\n\nif ((album != \"\") && (title != \"\")) {title = title + \" / \"  }\nif ((title != \"\") && (artist != \"\")) {artist = artist + \" - \"  }\n\nmsg.payload =  artist + title + album ;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1980,"y":3320,"wires":[["820cb2d9.639cf"]]},{"id":"79a5efc3.487e","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/thecheese","method":"get","upload":false,"swaggerDoc":"","x":680,"y":3320,"wires":[["90e1669e.c73408"]]},{"id":"c8dcd1d1.0e9a8","type":"inject","z":"40eacea7.33a8e8","name":"Chill Out Zone Plus","props":[{"p":"url","v":"https://chillout.zone:8080/api/v2/history/?format=json&limit=1&offset=0&server=2","vt":"str"},{"p":"radio","v":"chilloutzoneplus","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.8","topic":"","x":1040,"y":3380,"wires":[["5cb19ff7.9ee42"]]},{"id":"5cb19ff7.9ee42","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":3380,"wires":[["4ef0a99b.49b7e8"]]},{"id":"4ef0a99b.49b7e8","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":3380,"wires":[["f6e9d5bd.9cb0b","b7c71385.0a1288"],[]]},{"id":"f6e9d5bd.9cb0b","type":"json","z":"40eacea7.33a8e8","name":"","property":"payload","action":"","pretty":false,"x":1550,"y":3380,"wires":[["341e3ff0.2159a"]]},{"id":"341e3ff0.2159a","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload.results","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1670,"y":3380,"wires":[["9a94175b.2b5c3"],[]]},{"id":"9a94175b.2b5c3","type":"function","z":"40eacea7.33a8e8","name":"chilloutzoneplus processing","func":"\nvar item = msg.payload.results[0];\n\nmsg.artist = item.author;\nmsg.title = item.title;\nmsg.payload = item.metadata;\n\nif (msg.title ==\"\")\n    msg.mode =\"program\"\nelse\n    msg.mode = \"song\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2001,"y":3380,"wires":[["5ee7469e.d59338"]]},{"id":"45172fd8.4ec61","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/chilloutzoneplus","method":"get","upload":false,"swaggerDoc":"","x":700,"y":3380,"wires":[["90e1669e.c73408"]]},{"id":"eedacb60.b59358","type":"inject","z":"40eacea7.33a8e8","name":"H2O","props":[{"p":"url","v":"https://www.h2oradio.fr/majtitreandpochette.php","vt":"str"},{"p":"radio","v":"h2o","vt":"str"},{"p":"sendtoicecast","v":"false","vt":"bool"}],"repeat":"9","crontab":"","once":true,"onceDelay":"3.8","topic":"","x":990,"y":3420,"wires":[["ae6e92d.cf0c17"]]},{"id":"ae6e92d.cf0c17","type":"http request","z":"40eacea7.33a8e8","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1290,"y":3420,"wires":[["8cfb669a.f3df28"]]},{"id":"8cfb669a.f3df28","type":"switch","z":"40eacea7.33a8e8","name":"tst200","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1430,"y":3420,"wires":[["43ff892d.4c9728","b7c71385.0a1288"],[]]},{"id":"d0d2e7be.426bb","type":"switch","z":"40eacea7.33a8e8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nnull"},{"t":"else"}],"checkall":"false","repair":true,"outputs":2,"x":1730,"y":3420,"wires":[["2689cdd8.431c52"],[]]},{"id":"2689cdd8.431c52","type":"function","z":"40eacea7.33a8e8","name":"h2o processing","func":"var item = msg.payload[0];\n\nitem = item.split('<strong>');\nitem = item[1].split('</strong><br/>');\n\nvar artist = item[0];\nvar title = item [1];\n\nmsg.artist=artist;\nmsg.title = title;\n\n\nmsg.payload = artist + \" - \"+title; \n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1969,"y":3420,"wires":[["820cb2d9.639cf"]]},{"id":"bfa8f471.90d35","type":"http in","z":"40eacea7.33a8e8","name":"","url":"/h2o","method":"get","upload":false,"swaggerDoc":"","x":660,"y":3420,"wires":[["90e1669e.c73408"]]},{"id":"43ff892d.4c9728","type":"html","z":"40eacea7.33a8e8","name":"","property":"payload","outproperty":"payload","tag":"font","ret":"html","as":"single","x":1560,"y":3420,"wires":[["d0d2e7be.426bb"]]}]